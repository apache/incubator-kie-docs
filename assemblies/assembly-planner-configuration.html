<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>Configuring {PLANNER}</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
</head>
<body id="assembly-planner-configuration_{context}" class="article">
<div id="header">
<h1>Configuring {PLANNER}</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Solving a planning problem with OptaPlanner consists of the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Model your planning problem</strong> as a class annotated with the <code>@PlanningSolution</code> annotation, for example the <code>NQueens</code> class.</p>
</li>
<li>
<p><strong>Configure a Solver</strong>, for example a First Fit and Tabu Search solver for any <code>NQueens</code> instance.</p>
</li>
<li>
<p><strong>Load a problem data set</strong> from your data layer, for example a Four Queens instance. That is the planning problem.</p>
</li>
<li>
<p><strong>Solve it</strong> with <code>Solver.solve(problem)</code> which returns the best solution found.</p>
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="optimizer/inputOutputOverview.png" alt="inputOutputOverview">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="solverConfiguration">Solver configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="solverConfigurationByXML">Solver configuration by XML</h3>
<div class="paragraph">
<p>You can use an XML file to configure the solver:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build a <code>Solver</code> instance with the <code>SolverFactory</code>.</p>
</li>
<li>
<p>Configure the <code>SolverFactory</code> with a solver configuration XML file, provided as a classpath resource (as defined by <code>ClassLoader.getResource()</code>):</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">       SolverFasctory&lt;NQueens&gt; solverFactory = SolverFactory.createFromXmlResource(
               "org/optaplanner/examples/nqueens/solver/nqueensSolverConfig.xml");
       Solver&lt;NQueens&gt; solver = solverFactory.buildSolver();</code></pre>
</div>
</div>
<div class="paragraph">
<p>In a typical project that follows the Maven directory structure, the solverConfig XML file is located in the <code>$PROJECT_DIR/src/main/resources/org/optaplanner/examples/nqueens/solver</code> directory. Alternatively, you can create a <code>SolverFactory</code> from a <code>File</code> with <code>SolverFactory.createFromXmlFile()</code>.
However, for portability reasons, a classpath resource is recommended.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>On some environments (<a href="#integrationWithOSGi">OSGi</a>, <a href="#integrationWithJBossModules">JBoss modules</a>, &#8230;&#8203;), classpath resources (such as the solver config, score DRLs and domain classes) in your JAR files might not be available to the default <code>ClassLoader</code> of the <code>optaplanner-core</code> JAR file.
In those cases, provide the <code>ClassLoader</code> of your classes as a parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">       SolverFactory&lt;NQueens&gt; solverFactory = SolverFactory.createFromXmlResource(
               ".../nqueensSolverConfig.xml", getClass().getClassLoader());</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Both a <code>Solver</code> and a <code>SolverFactory</code> have a generic type called <code>Solution_</code>, which is the class representing a <a href="#planningProblemAndPlanningSolution">planning problem and solution</a>.</p>
</div>
<div class="paragraph">
<p>The following example is a solver XML file for the nqueens problem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;solver xmlns="https://www.optaplanner.org/xsd/solver" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="https://www.optaplanner.org/xsd/solver https://www.optaplanner.org/xsd/solver/solver.xsd"&gt;
  &lt;!-- Define the model --&gt;
  &lt;solutionClass&gt;org.optaplanner.examples.nqueens.domain.NQueens&lt;/solutionClass&gt;
  &lt;entityClass&gt;org.optaplanner.examples.nqueens.domain.Queen&lt;/entityClass&gt;

  &lt;!-- Define the score function --&gt;
  &lt;scoreDirectorFactory&gt;
    &lt;scoreDrl&gt;org/optaplanner/examples/nqueens/solver/nQueensConstraints.drl&lt;/scoreDrl&gt;
  &lt;/scoreDirectorFactory&gt;

  &lt;!-- Configure the optimization algorithms (optional) --&gt;
  &lt;termination&gt;
    ...
  &lt;/termination&gt;
  &lt;constructionHeuristic&gt;
    ...
  &lt;/constructionHeuristic&gt;
  &lt;localSearch&gt;
    ...
  &lt;/localSearch&gt;
&lt;/solver&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the three parts in it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define the model.</p>
</li>
<li>
<p>Define the score function.</p>
</li>
<li>
<p>Optionally configure the optimization algorithm(s).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>OptaPlanner makes it relatively easy to switch optimization algorithm(s) just by changing the configuration. There is even a <a href="#benchmarker">Benchmarker</a> which enables you to test different configurations against each other and report the most appropriate configuration for your use case.</p>
</div>
</div>
<div class="sect2">
<h3 id="solverConfigurationByJavaAPI">Solver configuration by Java API</h3>
<div class="paragraph">
<p>You can configura a solver with the <code>SolverConfig</code> API. This is especially useful to change some values dynamically at runtime. For example, to change the running time based on system property before building the <code>Solver</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">        SolverConfig solverConfig = SolverConfig.createFromXmlResource(
                "org/optaplanner/examples/nqueens/solver/nqueensSolverConfig.xml");
        solverConfig.withTerminationConfig(new TerminationConfig()
                        .withMinutesSpentLimit(userInput));

        SolverFactory&lt;NQueens&gt; solverFactory = SolverFactory.create(solverConfig);
        Solver&lt;NQueens&gt; solver = solverFactory.buildSolver();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Every element in the solver configuration XML is available as a <code>*Config</code> class
or a property on a <code>*Config</code> class in the package namespace <code>org.optaplanner.core.config</code>.
These <code>*Config</code> classes are the Java representation of the XML format.
They build the runtime components (of the package namespace <code>org.optaplanner.core.impl</code>)
and assemble them into an efficient <code>Solver</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>To configure a <code>SolverFactory</code> dynamically for each user request, build a template <code>SolverConfig</code> during initialization and copy it with the copy constructor for each user request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">    private SolverConfig template;

    public void init() {
        template = SolverConfig.createFromXmlResource(
                "org/optaplanner/examples/nqueens/solver/nqueensSolverConfig.xml");
        template.setTerminationConfig(new TerminationConfig());
    }

    // Called concurrently from different threads
    public void userRequest(..., long userInput) {
        SolverConfig solverConfig = new SolverConfig(template); // Copy it
        solverConfig.getTerminationConfig().setMinutesSpentLimit(userInput);
        SolverFactory&lt;NQueens&gt; solverFactory = SolverFactory.create(solverConfig);
        Solver&lt;NQueens&gt; solver = solverFactory.buildSolver();
        ...
    }</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="annotationAlternatives">Annotation alternatives</h3>
<div class="paragraph">
<p>OptaPlanner needs to know which classes in your domain model are planning entities, which properties are planning variables, and so on. Use one of the following methods to do this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add class annotations and JavaBean property annotations on the domain model (recommended).
The property annotations must be on the getter method, not on the setter method.
Such a getter does not need to be public.</p>
</li>
<li>
<p>Add class annotations and field annotations on the domain model.
Such a field does not need to be public.</p>
</li>
<li>
<p>Do not add annotations but externalize the domain configuration in an XML file.
This is <a href="https://issues.redhat.com/browse/PLANNER-151">not yet supported</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This manual focuses on the first method, but both methods are supported.</p>
</div>
</div>
<div class="sect2">
<h3 id="domainAccess">Domain access</h3>
<div class="paragraph">
<p>By default, OptaPlanner accesses your domain using reflection. Reflection will always work but it is slow complared to direct access. Alternatively, you can configure OptaPlanner to access your domain using Gizmo, which will generate bytecode that directly accesses the
fieldsand methods of your domain without reflection. However, this method has the following restrictions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The planning annotations can only be on public fields and
public getters.</p>
</li>
<li>
<p><code>io.quarkus.gizmo:gizmo</code> must be on the classpath.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
These restrictions do not apply when using OptaPlanner with Quarkus,
where Gizmo is the default domain access type.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To use Gizmo outside of Quarkus, set the <code>domainAccessType</code> in the
Solver Configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">  &lt;solver&gt;
    &lt;domainAccessType&gt;GIZMO&lt;/domainAccessType&gt;
  &lt;/solver&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="customPropertiesConfiguration">Custom properties configuration</h3>
<div class="paragraph">
<p>Solver configuration elements that instantiate classes and explicitly mention it, support custom properties.
Custom properties are useful to tweak dynamic values through the <a href="#benchmarker">Benchmarker</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have a solver.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add a custom property.</p>
<div class="paragraph">
<p>For example, if your <code>EasyScoreCalculator</code> has heavy calculations which are cached
and you want to increase the cache size in one benchmark add the <code>myCacheSize</code> property:</p>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">  &lt;scoreDirectorFactory&gt;
    &lt;easyScoreCalculatorClass&gt;...MyEasyScoreCalculator&lt;/easyScoreCalculatorClass&gt;
    &lt;easyScoreCalculatorCustomProperties&gt;
      &lt;property name="myCacheSize" value="1000"/&gt;&lt;!-- Override value --&gt;
    &lt;/easyScoreCalculatorCustomProperties&gt;
  &lt;/scoreDirectorFactory&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add a public setter for each custom property, which is called when a <code>Solver</code> is built.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">public class MyEasyScoreCalculator extends EasyScoreCalculator&lt;MySolution, SimpleScore&gt; {

        private int myCacheSize = 500; // Default value

        @SuppressWarnings("unused")
        public void setMyCacheSize(int myCacheSize) {
            this.myCacheSize = myCacheSize;
        }

    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Most value types are supported, including <code>boolean</code>, <code>int</code>, <code>double</code>, <code>BigDecimal</code>, <code>String</code> and <code>enums</code>.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="problemFact">Problem fact</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A problem fact is any JavaBean (POJO) with getters that does not change during planning.
For example in n queens, the columns and rows are problem facts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">public class Column {

    private int index;

    // ... getters
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">public class Row {

    private int index;

    // ... getters
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A problem fact can reference other problem facts of course:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">public class Course {

    private String code;

    private Teacher teacher; // Other problem fact
    private int lectureSize;
    private int minWorkingDaySize;

    private List&lt;Curriculum&gt; curriculumList; // Other problem facts
    private int studentSize;

    // ... getters
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A problem fact class does <em>not</em> require any OptaPlanner specific code.
For example, you can reuse your domain classes, which might have JPA annotations.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Generally, better designed domain classes lead to simpler and more efficient score constraints.
Therefore, when dealing with a messy (denormalized) legacy system, it can sometimes be worthwhile to convert the messy domain model into a OptaPlanner specific model first.
For example: if your domain model has two <code>Teacher</code> instances for the same teacher that teaches at two different departments, it is harder to write a correct score constraint that constrains a teacher&#8217;s spare time on the original model than on an adjusted model.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can sometimes also introduce <a href="#cachedProblemFact"><em>a cached problem fact</em></a> to enrich the domain model for planning only.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="planningEntity">Planning entity</h3>
<div class="sect3">
<h4 id="planningEntityAnnotation">Planning entity annotation</h4>
<div class="paragraph">
<p>A planning entity is a JavaBean (POJO) that changes during solving, for example a <code>Queen</code> that changes to another row.
A planning problem has multiple planning entities, for example for a single n queens problem, each <code>Queen</code> is a planning entity.
But there is usually only one planning entity class, for example the <code>Queen</code> class.</p>
</div>
<div class="paragraph">
<p>A planning entity class needs to be annotated with the <code>@PlanningEntity</code> annotation.</p>
</div>
<div class="paragraph">
<p>Each planning entity class has one or more <em>planning variables</em> (which can be <a href="#planningVariable">genuine</a> or <a href="#shadowVariable">shadows</a>).
It should also have one or more <em>defining</em> properties.
For example in n queens, a <code>Queen</code> is defined by its <code>Column</code> and has a planning variable <code>Row</code>.
This means that a Queen&#8217;s column never changes during solving, while its row does change.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@PlanningEntity
public class Queen {

    private Column column;

    // Planning variables: changes during planning, between score calculations.
    private Row row;

    // ... getters and setters
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A planning entity class can have multiple planning variables.
For example, a <code>Lecture</code> is defined by its <code>Course</code> and its index in that course (because one course has multiple lectures).
Each <code>Lecture</code> needs to be scheduled into a <code>Period</code> and a <code>Room</code> so it has two planning variables (period and room).
For example: the course Mathematics has eight lectures per week, of which the first lecture is Monday morning at 08:00 in room 212.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@PlanningEntity
public class Lecture {

    private Course course;
    private int lectureIndexInCourse;

    // Planning variables: changes during planning, between score calculations.
    private Period period;
    private Room room;

    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The solver configuration needs to declare each planning entity class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">&lt;solver xmlns="https://www.optaplanner.org/xsd/solver" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="https://www.optaplanner.org/xsd/solver https://www.optaplanner.org/xsd/solver/solver.xsd"&gt;
  ...
  &lt;entityClass&gt;org.optaplanner.examples.nqueens.domain.Queen&lt;/entityClass&gt;
  ...
&lt;/solver&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some uses cases have multiple planning entity classes.
For example: route freight and trains into railway network arcs, where each freight can use multiple trains over its journey and each train can carry multiple freights per arc.
Having multiple planning entity classes directly raises the implementation complexity of your use case.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><em>Do not create unnecessary planning entity classes.</em> This leads to difficult <code>Move</code> implementations and slower score calculation.</p>
</div>
<div class="paragraph">
<p>For example, do not create a planning entity class to hold the total free time of a teacher, which needs to be kept up to date as the <code>Lecture</code> planning entities change.
Instead, calculate the free time in the score constraints (or as a <a href="#shadowVariable">shadow variable</a>) and put the result per teacher into a logically inserted score object.</p>
</div>
<div class="paragraph">
<p>If historic data needs to be considered too, then create problem fact to hold the total of the historic assignments up to, but <em>not including</em>, the planning window (so that it does not change when a planning entity changes) and let the score constraints take it into account.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Planning entity <code>hashCode()</code> implementations must remain constant. Therefore entity <code>hashCode()</code> must not depend on any planning variables. Pay special attention when using data structures with auto-generated <code>hashCode()</code> as entities, such as Java records or Kotlin data classes. <code>`</code></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="planningEntityDifficulty">Planning entity difficulty</h4>
<div class="paragraph">
<p>Some optimization algorithms work more efficiently if they have an estimation of which planning entities are more difficult to plan.
For example: in bin packing bigger items are harder to fit, in course scheduling lectures with more students are more difficult to schedule, and in n queens the middle queens are more difficult to fit on the board.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Do not try to use planning entity difficulty to implement a business
          constraint.</strong> It will not affect the score function: if we have infinite solving time, the returned solution will be the same.</p>
</div>
<div class="paragraph">
<p>To attain a schedule in which certain entities are scheduled earlier in the schedule, <a href="#formalizeTheBusinessConstraints">add a score constraint</a> to change the score function so it prefers such solutions.
Only consider adding planning entity difficulty too if it can make the solver more efficient.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To allow the heuristics to take advantage of that domain specific information, set a <code>difficultyComparatorClass</code> to the <code>@PlanningEntity</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@PlanningEntity(difficultyComparatorClass = CloudProcessDifficultyComparator.class)
public class CloudProcess {
    // ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">public class CloudProcessDifficultyComparator implements Comparator&lt;CloudProcess&gt; {

    public int compare(CloudProcess a, CloudProcess b) {
        return new CompareToBuilder()
                .append(a.getRequiredMultiplicand(), b.getRequiredMultiplicand())
                .append(a.getId(), b.getId())
                .toComparison();
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can also set a <code>difficultyWeightFactoryClass</code> to the <code>@PlanningEntity</code> annotation,
so that you have access to the rest of the problem facts from the solution too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@PlanningEntity(difficultyWeightFactoryClass = QueenDifficultyWeightFactory.class)
public class Queen {
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#sortedSelection">sorted selection</a> for more information.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Difficulty should be implemented ascending: easy entities are lower, difficult entities are higher.
For example, in bin packing: small item &lt; medium item &lt; big item.</p>
</div>
<div class="paragraph">
<p>Although most algorithms start with the more difficult entities first, they just reverse the ordering.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>None of the current planning variable states should be used to compare planning entity difficulty.</em> During Construction Heuristics, those variables are likely to be <code>null</code> anyway.
For example, a <code>Queen</code>'s <code>row</code> variable should not be used.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="planningVariable">Planning variable (genuine)</h3>
<div class="sect3">
<h4 id="planningVariableAnnotation">Planning variable annotation</h4>
<div class="paragraph">
<p>A planning variable is a JavaBean property (so a getter and setter) on a planning entity.
It points to a planning value, which changes during planning.
For example, a <code>Queen</code>'s <code>row</code> property is a genuine planning variable.
Note that even though a <code>Queen</code>'s <code>row</code> property changes to another <code>Row</code> during planning, no <code>Row</code> instance itself is changed.
Normally planning variables are genuine, but advanced cases can also have <a href="#shadowVariable">shadows</a>.</p>
</div>
<div class="paragraph">
<p>A genuine planning variable getter needs to be annotated with the <code>@PlanningVariable</code> annotation, which needs a non-empty <code>valueRangeProviderRefs</code> property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@PlanningEntity
public class Queen {
    ...

    private Row row;

    @PlanningVariable(valueRangeProviderRefs = {"rowRange"})
    public Row getRow() {
        return row;
    }

    public void setRow(Row row) {
        this.row = row;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>valueRangeProviderRefs</code> property defines what are the possible planning values for this planning variable.
It references one or more <code>@ValueRangeProvider</code> <code>id</code>'s.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>A @PlanningVariable annotation needs to be on a member in a class with a @PlanningEntity annotation.
It is ignored on parent classes or subclasses without that annotation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="#annotationAlternatives">Annotating the field</a> instead of the property works too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@PlanningEntity
public class Queen {
    ...

    @PlanningVariable(valueRangeProviderRefs = {"rowRange"})
    private Row row;

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="nullablePlanningVariable">Nullable planning variable</h4>
<div class="paragraph">
<p>By default, an initialized planning variable cannot be <code>null</code>, so an initialized solution will never use <code>null</code> for any of its planning variables.
In an over-constrained use case, this can be counterproductive.
For example: in task assignment with too many tasks for the workforce, we would rather leave low priority tasks unassigned instead of assigning them to an overloaded worker.</p>
</div>
<div class="paragraph">
<p>To allow an initialized planning variable to be <code>null</code>, set <code>nullable</code> to <code>true</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">    @PlanningVariable(..., nullable = true)
    public Worker getWorker() {
        return worker;
    }</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Constraint Streams filter out planning entities with a <code>null</code> planning variable by default.
Use <a href="#constraintStreamsFrom">fromUnfiltered()</a> to avoid such unwanted behaviour.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>OptaPlanner will automatically add the value <code>null</code> to the value range.
There is no need to add <code>null</code> in a collection provided by a <code>ValueRangeProvider</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Using a nullable planning variable implies that your score calculation is responsible for punishing (or even rewarding) variables with a <code>null</code> value.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Currently <a href="#chainedPlanningVariable">chained</a> planning variables are not compatible with <code>nullable</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="#repeatedPlanning">Repeated planning</a> (especially <a href="#realTimePlanning">real-time planning</a>) does not mix well with a nullable planning variable.
Every time the Solver starts or a problem fact change is made, the <a href="#constructionHeuristics">Construction Heuristics</a>
will try to initialize all the <code>null</code> variables again, which can be a huge waste of time.
One way to deal with this is to filter the entity selector of the placer in the construction heuristic.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;solver xmlns="https://www.optaplanner.org/xsd/solver" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="https://www.optaplanner.org/xsd/solver https://www.optaplanner.org/xsd/solver/solver.xsd"&gt;
  ...
  &lt;constructionHeuristics&gt;
    &lt;queuedEntityPlacer&gt;
      &lt;entitySelector id="entitySelector1"&gt;
        &lt;filterClass&gt;...&lt;/filterClass&gt;
      &lt;/entitySelector&gt;
    &lt;/queuedEntityPlacer&gt;
    ...
    &lt;changeMoveselector&gt;
      &lt;entitySelector mimicRef="entitySelector1" /&gt;
    &lt;/changeMoveselector&gt;
    ...
  &lt;/constructionHeuristics&gt;
 ...
&lt;/solver&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="whenIsAPlanningVariableInitialized">When is a planning variable considered initialized?</h4>
<div class="paragraph">
<p>A planning variable is considered initialized if its value is not <code>null</code> or if the variable is <code>nullable</code>.
So a nullable variable is always considered initialized.</p>
</div>
<div class="paragraph">
<p>A planning entity is initialized if all of its planning variables are initialized.</p>
</div>
<div class="paragraph">
<p>A solution is initialized if all of its planning entities are initialized.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="planningValueAndPlanningValueRange">Planning value and planning value range</h3>
<div class="sect3">
<h4 id="planningValue">Planning value</h4>
<div class="paragraph">
<p>A planning value is a possible value for a genuine planning variable.
Usually, a planning value is a problem fact, but it can also be any object, for example a <code>double</code>.
It can even be another planning entity or even an interface implemented by both a planning entity and a problem fact.</p>
</div>
<div class="paragraph">
<p>A planning value range is the set of possible planning values for a planning variable.
This set can be a countable (for example row <code>1</code>, <code>2</code>, <code>3</code> or <code>4</code>) or uncountable (for example any <code>double</code> between <code>0.0</code> and <code>1.0</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="planningValueRangeProvider">Planning value range provider</h4>
<div class="sect4">
<h5 id="planningValueRangeProviderOverview">Overview</h5>
<div class="paragraph">
<p>The value range of a planning variable is defined with the <code>@ValueRangeProvider</code> annotation.
A <code>@ValueRangeProvider</code> annotation always has a property <code>id</code>, which is referenced by the <code>@PlanningVariable</code>'s property <code>valueRangeProviderRefs</code>.</p>
</div>
<div class="paragraph">
<p>This annotation can be located on two types of methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On the Solution: All planning entities share the same value range.</p>
</li>
<li>
<p>On the planning entity: The value range differs per planning entity. This is less common.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>A @ValueRangeProvider annotation needs to be on a member in a class with a @PlanningSolution or a @PlanningEntity annotation.
It is ignored on parent classes or subclasses without those annotations.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The return type of that method can be three types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Collection</code>: The value range is defined by a <code>Collection</code> (usually a <code>List</code>) of its possible values.</p>
</li>
<li>
<p>Array: The value range is defined by an array of its possible values.</p>
</li>
<li>
<p><code>ValueRange</code>: The value range is defined by its bounds. This is less common.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="valueRangeProviderOnSolution"><code>ValueRangeProvider</code> on the solution</h5>
<div class="paragraph">
<p>All instances of the same planning entity class share the same set of possible planning values for that planning variable.
This is the most common way to configure a value range.</p>
</div>
<div class="paragraph">
<p>The <code>@PlanningSolution</code> implementation has method that returns a <code>Collection</code> (or a <code>ValueRange</code>).
Any value from that <code>Collection</code> is a possible planning value for this planning variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">    @PlanningVariable(valueRangeProviderRefs = {"rowRange"})
    public Row getRow() {
        return row;
    }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@PlanningSolution
public class NQueens {
    ...

    @ValueRangeProvider(id = "rowRange")
    public List&lt;Row&gt; getRowList() {
        return rowList;
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>That <code>Collection</code> (or <code>ValueRange</code>) must not contain the value <code>null</code>, not even for a <a href="#nullablePlanningVariable">nullable planning variable</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="#annotationAlternatives">Annotating the field</a> instead of the property works too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@PlanningSolution
public class NQueens {
    ...

    @ValueRangeProvider(id = "rowRange")
    private List&lt;Row&gt; rowList;

}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="valueRangeProviderOnPlanningEntity"><code>ValueRangeProvider</code> on the Planning Entity</h5>
<div class="paragraph">
<p>Each planning entity has its own value range (a set of possible planning values) for the planning variable.
For example, if a teacher can <strong>never</strong> teach in a room that does not belong to his department, lectures of that teacher can limit their room value range to the rooms of his department.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">    @PlanningVariable(valueRangeProviderRefs = {"departmentRoomRange"})
    public Room getRoom() {
        return room;
    }

    @ValueRangeProvider(id = "departmentRoomRange")
    public List&lt;Room&gt; getPossibleRoomList() {
        return getCourse().getTeacher().getDepartment().getRoomList();
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Never use this to enforce a soft constraint (or even a hard constraint when the problem might not have a feasible solution). For example: <em>Unless there is no other way</em>, a teacher cannot teach in a room that does not belong to his department.
In this case, the teacher should <em>not</em> be limited in his room value range (because sometimes there is no other way).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>By limiting the value range specifically of one planning entity, you are effectively creating a <em>built-in hard constraint</em>.
This can have the benefit of severely lowering the number of possible solutions; however, it can also take away the freedom of the optimization algorithms to temporarily break that constraint in order to escape from a local optimum.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A planning entity should <em>not</em> use other planning entities to determine its value range.
That would only try to make the planning entity solve the planning problem itself and interfere with the optimization algorithms.</p>
</div>
<div class="paragraph">
<p>Every entity has its own <code>List</code> instance, unless multiple entities have the same value range.
For example, if teacher A and B belong to the same department, they use the same <code>List&lt;Room&gt;</code> instance.
Furthermore, each <code>List</code> contains a subset of the same set of planning value instances.
For example, if department A and B can both use room X, then their <code>List&lt;Room&gt;</code> instances contain the same <code>Room</code> instance.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>A <code>ValueRangeProvider</code> on the planning entity consumes more memory than <code>ValueRangeProvider</code> on the Solution and disables certain automatic performance optimizations.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>A <code>ValueRangeProvider</code> on the planning entity is not currently compatible with a <a href="#chainedPlanningVariable">chained</a> variable.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="valueRangeFactory"><code>ValueRangeFactory</code></h5>
<div class="paragraph">
<p>Instead of a <code>Collection</code>, you can also return a <code>ValueRange</code> or <code>CountableValueRange</code>, build by the <code>ValueRangeFactory</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">    @ValueRangeProvider(id = "delayRange")
    public CountableValueRange&lt;Integer&gt; getDelayRange() {
        return ValueRangeFactory.createIntValueRange(0, 5000);
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>ValueRange</code> uses far less memory, because it only holds the bounds.
In the example above, a <code>Collection</code> would need to hold all <code>5000</code> ints, instead of just the two bounds.</p>
</div>
<div class="paragraph">
<p>Furthermore, an <code>incrementUnit</code> can be specified, for example if you have to buy stocks in units of 200 pieces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">    @ValueRangeProvider(id = "stockAmountRange")
    public CountableValueRange&lt;Integer&gt; getStockAmountRange() {
         // Range: 0, 200, 400, 600, ..., 9999600, 9999800, 10000000
        return ValueRangeFactory.createIntValueRange(0, 10000000, 200);
    }</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Return <code>CountableValueRange</code> instead of <code>ValueRange</code> whenever possible (so OptaPlanner knows that it&#8217;s countable).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>ValueRangeFactory</code> has creation methods for several value class types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>boolean</code>: A boolean range.</p>
</li>
<li>
<p><code>int</code>: A 32bit integer range.</p>
</li>
<li>
<p><code>long</code>: A 64bit integer range.</p>
</li>
<li>
<p><code>double</code>: A 64bit floating point range which only supports random selection (because it does not implement <code>CountableValueRange</code>).</p>
</li>
<li>
<p><code>BigInteger</code>: An arbitrary-precision integer range.</p>
</li>
<li>
<p><code>BigDecimal</code>: A decimal point range. By default, the increment unit is the lowest non-zero value in the scale of the bounds.</p>
</li>
<li>
<p><code>Temporal</code> (such as <code>LocalDate</code>, <code>LocalDateTime</code>, &#8230;&#8203;): A time range.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="combineValueRangeProviders">Combine <code>ValueRangeProviders</code></h5>
<div class="paragraph">
<p>Value range providers can be combined, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">    @PlanningVariable(valueRangeProviderRefs = {"companyCarRange", "personalCarRange"})
    public Car getCar() {
        return car;
    }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">    @ValueRangeProvider(id = "companyCarRange")
    public List&lt;CompanyCar&gt; getCompanyCarList() {
        return companyCarList;
    }

    @ValueRangeProvider(id = "personalCarRange")
    public List&lt;PersonalCar&gt; getPersonalCarList() {
        return personalCarList;
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="planningValueStrength">Planning value strength</h4>
<div class="paragraph">
<p>Some optimization algorithms work a bit more efficiently if they have an estimation of which planning values are stronger, which means they are more likely to satisfy a planning entity.
For example: in bin packing bigger containers are more likely to fit an item and in course scheduling bigger rooms are less likely to break the student capacity constraint.
Usually, the efficiency gain of planning value strength is far less than that of <a href="#planningEntityDifficulty">planning entity difficulty</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Do not try to use planning value strength to implement a business
          constraint.</strong> It will not affect the score function: if we have infinite solving time, the returned solution will be the same.</p>
</div>
<div class="paragraph">
<p>To affect the score function, <a href="#formalizeTheBusinessConstraints">add a score constraint</a>.
Only consider adding planning value strength too if it can make the solver more efficient.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To allow the heuristics to take advantage of that domain specific information, set a <code>strengthComparatorClass</code> to the <code>@PlanningVariable</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">    @PlanningVariable(..., strengthComparatorClass = CloudComputerStrengthComparator.class)
    public CloudComputer getComputer() {
        return computer;
    }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">public class CloudComputerStrengthComparator implements Comparator&lt;CloudComputer&gt; {

    public int compare(CloudComputer a, CloudComputer b) {
        return new CompareToBuilder()
                .append(a.getMultiplicand(), b.getMultiplicand())
                .append(b.getCost(), a.getCost()) // Descending (but this is debatable)
                .append(a.getId(), b.getId())
                .toComparison();
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you have multiple planning value classes in the <em>same</em> value range, the <code>strengthComparatorClass</code> needs to implement a <code>Comparator</code> of a common superclass (for example <code>Comparator&lt;Object&gt;</code>) and be able to handle comparing instances of those different classes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, you can also set a <code>strengthWeightFactoryClass</code> to the <code>@PlanningVariable</code> annotation, so you have access to the rest of the problem facts from the solution too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">    @PlanningVariable(..., strengthWeightFactoryClass = RowStrengthWeightFactory.class)
    public Row getRow() {
        return row;
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#sortedSelection">sorted selection</a> for more information.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Strength should be implemented ascending: weaker values are lower, stronger values are higher.
For example in bin packing: small container &lt; medium container &lt; big container.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>None of the current planning variable state in any of the planning entities should be used to compare planning values.</em> During construction heuristics, those variables are likely to be <code>null</code>.
For example, none of the <code>row</code> variables of any <code>Queen</code> may be used to determine the strength of a <code>Row</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="chainedPlanningVariable">Chained planning variable (TSP, VRP, &#8230;&#8203;)</h4>
<div class="paragraph">
<p>Some use cases, such as TSP and Vehicle Routing, require <em>chaining</em>.
This means the planning entities point to each other and form a chain.
By modeling the problem as a set of chains (instead of a set of trees/loops), the search space is heavily reduced.</p>
</div>
<div class="paragraph">
<p>A planning variable that is chained either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Directly points to a problem fact (or planning entity), which is called an <em>anchor</em>.</p>
</li>
<li>
<p>Points to another planning entity with the same planning variable, which recursively points to an anchor.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here are some examples of valid and invalid chains:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="optimizer/chainPrinciples.png" alt="chainPrinciples">
</div>
</div>
<div class="paragraph">
<p><strong>Every initialized planning entity is part of an open-ended chain that begins from an anchor.</strong> A valid model means that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A chain is never a loop. The tail is always open.</p>
</li>
<li>
<p>Every chain always has exactly one anchor. The anchor is never an instance of the planning entity class that contains the chained planning variable.</p>
</li>
<li>
<p>A chain is never a tree, it is always a line. Every anchor or planning entity has at most one trailing planning entity.</p>
</li>
<li>
<p>Every initialized planning entity is part of a chain.</p>
</li>
<li>
<p>An anchor with no planning entities pointing to it, is also considered a chain.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>A planning problem instance given to the <code>Solver</code> must be valid.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If your constraints dictate a closed chain, model it as an open-ended chain (which is easier to persist in a database) and implement a score constraint for the last entity back to the anchor.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The optimization algorithms and built-in <code>Move</code>s do chain correction to guarantee that the model stays valid:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="optimizer/chainPrinciples.png" alt="chainPrinciples">
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>A custom <code>Move</code> implementation must leave the model in a valid state.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, in TSP the anchor is a <code>Domicile</code> (in vehicle routing it is <code>Vehicle</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">public class Domicile ... implements Standstill {
    ...

    public City getCity() {...}

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The anchor (which is a problem fact) and the planning entity implement a common interface, for example TSP&#8217;s <code>Standstill</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">public interface Standstill {

    City getCity();

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>That interface is the return type of the planning variable.
Furthermore, the planning variable is chained.
For example TSP&#8217;s <code>Visit</code> (in vehicle routing it is <code>Customer</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@PlanningEntity
public class Visit ... implements Standstill {
    ...

    public City getCity() {...}

    @PlanningVariable(graphType = PlanningVariableGraphType.CHAINED,
        valueRangeProviderRefs = {"domicileRange", "visitRange"})
    public Standstill getPreviousStandstill() {
        return previousStandstill;
    }

    public void setPreviousStandstill(Standstill previousStandstill) {
        this.previousStandstill = previousStandstill;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how two value range providers are usually combined:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The value range provider that holds the anchors, for example <code>domicileList</code>.</p>
</li>
<li>
<p>The value range provider that holds the initialized planning entities, for example <code>visitList</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="planningProblemAndPlanningSolution">Planning problem and planning solution</h3>
<div class="sect3">
<h4 id="planningProblemInstance">Planning problem instance</h4>
<div class="paragraph">
<p>A dataset for a planning problem needs to be wrapped in a class for the <code>Solver</code> to solve.
That solution class represents both the planning problem and (if solved) a solution.
It is annotated with a <code>@PlanningSolution</code> annotation.
For example in n queens, the solution class is the <code>NQueens</code> class, which contains a <code>Column</code> list, a <code>Row</code> list, and a <code>Queen</code> list.</p>
</div>
<div class="paragraph">
<p>A planning problem is actually an unsolved planning solution or - stated differently - an uninitialized solution.
For example in n queens, that <code>NQueens</code> class has the <code>@PlanningSolution</code> annotation, yet every <code>Queen</code> in an unsolved <code>NQueens</code> class is not yet assigned to a <code>Row</code> (their <code>row</code> property is <code>null</code>). That&#8217;s not a feasible solution.
It&#8217;s not even a possible solution.
It&#8217;s an uninitialized solution.</p>
</div>
</div>
<div class="sect3">
<h4 id="solutionClass">Solution class</h4>
<div class="paragraph">
<p>A solution class holds all problem facts, planning entities and a score.
It is annotated with a <code>@PlanningSolution</code> annotation.
For example, an <code>NQueens</code> instance holds a list of all columns, all rows and all <code>Queen</code> instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@PlanningSolution
public class NQueens {

    // Problem facts
    private int n;
    private List&lt;Column&gt; columnList;
    private List&lt;Row&gt; rowList;

    // Planning entities
    private List&lt;Queen&gt; queenList;

    private SimpleScore score;

    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The solver configuration needs to declare the planning solution class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">&lt;solver xmlns="https://www.optaplanner.org/xsd/solver" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="https://www.optaplanner.org/xsd/solver https://www.optaplanner.org/xsd/solver/solver.xsd"&gt;
  ...
  &lt;solutionClass&gt;org.optaplanner.examples.nqueens.domain.NQueens&lt;/solutionClass&gt;
  ...
&lt;/solver&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="planningEntitiesOfASolution">Planning entities of a solution (<code>@PlanningEntityCollectionProperty</code>)</h4>
<div class="paragraph">
<p>OptaPlanner needs to extract the entity instances from the solution instance.
It gets those collection(s) by calling every getter (or field) that is annotated with <code>@PlanningEntityCollectionProperty</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@PlanningSolution
public class NQueens {
    ...

    private List&lt;Queen&gt; queenList;

    @PlanningEntityCollectionProperty
    public List&lt;Queen&gt; getQueenList() {
        return queenList;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There can be multiple <code>@PlanningEntityCollectionProperty</code> annotated members.
Those can even return a <code>Collection</code> with the same entity class type.
Instead of <code>Collection</code>, it can also return an array.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>A <code>@PlanningEntityCollectionProperty</code> annotation needs to be on a member in a class with a <code>@PlanningSolution</code> annotation.
It is ignored on parent classes or subclasses without that annotation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In rare cases, a planning entity might be a singleton: use <code>@PlanningEntityProperty</code> on its getter (or field) instead.</p>
</div>
<div class="paragraph">
<p>Both annotations can also be <a href="#autoDiscoverSolutionProperties">auto discovered</a> if enabled.</p>
</div>
</div>
<div class="sect3">
<h4 id="scoreOfASolution"><code>Score</code> of asSolution (<code>@PlanningScore</code>)</h4>
<div class="paragraph">
<p>A <code>@PlanningSolution</code> class requires a score property (or field), which is annotated with a <code>@PlanningScore</code> annotation.
The score property is <code>null</code> if the score hasn&#8217;t been calculated yet.
The <code>score</code> property is typed to the specific <code>Score</code> implementation of your use case.
For example, <code>NQueens</code> uses a <a href="#simpleScore">SimpleScore</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@PlanningSolution
public class NQueens {
    ...

    private SimpleScore score;

    @PlanningScore
    public SimpleScore getScore() {
        return score;
    }
    public void setScore(SimpleScore score) {
        this.score = score;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Most use cases use a <a href="#hardSoftScore">HardSoftScore</a> instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@PlanningSolution
public class CloudBalance {
    ...

    private HardSoftScore score;

    @PlanningScore
    public HardSoftScore getScore() {
        return score;
    }

    public void setScore(HardSoftScore score) {
        this.score = score;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some use cases use <a href="#scoreType">other score types</a>.</p>
</div>
<div class="paragraph">
<p>This annotation can also be <a href="#autoDiscoverSolutionProperties">auto discovered</a> if enabled.</p>
</div>
</div>
<div class="sect3">
<h4 id="problemFacts">Problem facts of a solution (<code>@ProblemFactCollectionProperty</code>)</h4>
<div class="paragraph">
<p>For <a href="#constraintStreams">constraint streams</a> and <a href="#droolsScoreCalculation">Drools score calculation</a>,
OptaPlanner needs to extract the problem fact instances from the solution instance.
It gets those collection(s) by calling every method (or field) that is annotated with <code>@ProblemFactCollectionProperty</code>.
All objects returned by those methods are available to use by the constraint streams or Drools rules.
For example in <code>NQueens</code> all <code>Column</code> and <code>Row</code> instances are problem facts.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@PlanningSolution
public class NQueens {
    ...

    private List&lt;Column&gt; columnList;
    private List&lt;Row&gt; rowList;

    @ProblemFactCollectionProperty
    public List&lt;Column&gt; getColumnList() {
        return columnList;
    }

    @ProblemFactCollectionProperty
    public List&lt;Row&gt; getRowList() {
        return rowList;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All planning entities are automatically inserted into the Drools working memory.
Do note add an annotation on their properties.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The problem facts methods are not called often: at most only once per solver phase per solver thread.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There can be multiple <code>@ProblemFactCollectionProperty</code> annotated members.
Those can even return a <code>Collection</code> with the same class type, but they shouldn&#8217;t return the same instance twice.
Instead of <code>Collection</code>, it can also return an array.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>A @ProblemFactCollectionProperty annotation needs to be on a member in a class with a @PlanningSolution annotation.
It is ignored on parent classes or subclasses without that annotation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In rare cases, a problem fact might be a singleton: use <code>@ProblemFactProperty</code> on its method (or field) instead.</p>
</div>
<div class="paragraph">
<p>Both annotations can also be <a href="#autoDiscoverSolutionProperties">auto discovered</a> if enabled.</p>
</div>
<div class="sect4">
<h5 id="cachedProblemFact">Cached problem fact</h5>
<div class="paragraph">
<p>A cached problem fact is a problem fact that does not exist in the real domain model, but is calculated before the <code>Solver</code> really starts solving.
The problem facts methods have the opportunity to enrich the domain model with such cached problem facts, which can lead to simpler and faster score constraints.</p>
</div>
<div class="paragraph">
<p>For example in examination, a cached problem fact <code>TopicConflict</code> is created for every two <code>Topic</code>s which share at least one <code>Student</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">    @ProblemFactCollectionProperty
    private List&lt;TopicConflict&gt; calculateTopicConflictList() {
        List&lt;TopicConflict&gt; topicConflictList = new ArrayList&lt;TopicConflict&gt;();
        for (Topic leftTopic : topicList) {
            for (Topic rightTopic : topicList) {
                if (leftTopic.getId() &lt; rightTopic.getId()) {
                    int studentSize = 0;
                    for (Student student : leftTopic.getStudentList()) {
                        if (rightTopic.getStudentList().contains(student)) {
                            studentSize++;
                        }
                    }
                    if (studentSize &gt; 0) {
                        topicConflictList.add(new TopicConflict(leftTopic, rightTopic, studentSize));
                    }
                }
            }
        }
        return topicConflictList;
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where a score constraint needs to check that no two exams with a topic that shares a student are scheduled close together (depending on the constraint: at the same time, in a row, or in the same day), the <code>TopicConflict</code> instance can be used as a problem fact, rather than having to combine every two <code>Student</code> instances.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="autoDiscoverSolutionProperties">Auto discover solution properties</h4>
<div class="paragraph">
<p>Instead of configuring each property (or field) annotation explicitly,
some can also be deduced automatically by OptaPlanner.
For example, on the cloud balancing example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@PlanningSolution(autoDiscoverMemberType = AutoDiscoverMemberType.FIELD)
public class CloudBalance {

    // Auto discovered as @ProblemFactCollectionProperty
    @ValueRangeProvider(id = "computerRange") // Not (yet) auto discovered
    private List&lt;CloudComputer&gt; computerList;

    // Auto discovered as @PlanningEntityCollectionProperty
    private List&lt;CloudProcess&gt; processList;

    // Auto discovered as @PlanningScore
    private HardSoftScore score;

    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>AutoDiscoverMemberType</code> can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>NONE</code>: No auto discovery.</p>
</li>
<li>
<p><code>FIELD</code>: Auto discover all fields on the <code>@PlanningSolution</code> class</p>
</li>
<li>
<p><code>GETTER</code>: Auto discover all getters on the <code>@PlanningSolution</code> class</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The automatic annotation is based on the field type (or getter return type):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@ProblemFactProperty</code>: when it isn&#8217;t a <code>Collection</code>, an array, a <code>@PlanningEntity</code> class or a <code>Score</code></p>
</li>
<li>
<p><code>@ProblemFactCollectionProperty</code>: when it&#8217;s a <code>Collection</code> (or array) of a type that isn&#8217;t a <code>@PlanningEntity</code> class</p>
</li>
<li>
<p><code>@PlanningEntityProperty</code>: when it is a configured <code>@PlanningEntity</code> class or subclass</p>
</li>
<li>
<p><code>@PlanningEntityCollectionProperty</code>: when it&#8217;s a <code>Collection</code> (or array) of a type that is a configured <code>@PlanningEntity</code> class or subclass</p>
</li>
<li>
<p><code>@PlanningScore</code>: when it is a <code>Score</code> or subclass</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These automatic annotation can still be overwritten per field (or getter).
Specifically, a <a href="#bendableScore">BendableScore</a> always needs to override
with an explicit <code>@PlanningScore</code> annotation to define the number of hard and soft levels.</p>
</div>
</div>
<div class="sect3">
<h4 id="cloningASolution">Cloning a solution</h4>
<div class="paragraph">
<p>Most (if not all) optimization algorithms clone the solution each time they encounter a new best solution (so they can recall it later) or to work with multiple solutions in parallel.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>There are many ways to clone, such as a shallow clone, deep clone, &#8230;&#8203; This context focuses on <em>a planning clone</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A planning clone of a solution must fulfill these requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The clone must represent the same planning problem. Usually it reuses the same instances of the problem facts and problem fact collections as the original.</p>
</li>
<li>
<p>The clone must use different, cloned instances of the entities and entity collections.
Changes to an original solution entity&#8217;s variables must not affect its clone.</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="optimizer/solutionCloning.png" alt="solutionCloning">
</div>
</div>
<div class="paragraph">
<p><strong>Implementing a planning clone method is hard, therefore you do not need to implement it.</strong></p>
</div>
<div class="sect4">
<h5 id="fieldAccessingSolutionCloner"><code>FieldAccessingSolutionCloner</code></h5>
<div class="paragraph">
<p>This <code>SolutionCloner</code> is used by default.
It works well for most use cases.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>When the <code>FieldAccessingSolutionCloner</code> clones one of your collections or maps,
it may not recognize the implementation and replace it with <code>ArrayList</code>, <code>LinkedHashSet</code>, <code>TreeSet</code>, <code>LinkedHashMap</code>
or <code>TreeMap</code> (whichever is more applicable) .
It recognizes most of the common JDK collection and map implementations.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>FieldAccessingSolutionCloner</code> does not clone problem facts by default.
If any of your problem facts needs to be deep cloned for a planning clone,
for example if the problem fact references a planning entity or the planning solution,
mark its class with a <code>@DeepPlanningClone</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@DeepPlanningClone
public class SeatDesignationDependency {
    private SeatDesignation leftSeatDesignation; // planning entity
    private SeatDesignation rightSeatDesignation; // planning entity
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, because <code>SeatDesignationDependency</code> references the planning entity <code>SeatDesignation</code>
(which is deep planning cloned automatically), it should also be deep planning cloned.</p>
</div>
<div class="paragraph">
<p>Alternatively, the <code>@DeepPlanningClone</code> annotation also works on a getter method or a field to planning clone it.
If that property is a <code>Collection</code> or a <code>Map</code>, it will shallow clone it and deep planning clone
any element thereof that is an instance of a class that has a <code>@DeepPlanningClone</code> annotation.</p>
</div>
</div>
<div class="sect4">
<h5 id="customCloning">Custom cloning with a <code>SolutionCloner</code></h5>
<div class="paragraph">
<p>To use a custom cloner, configure it on the planning solution:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@PlanningSolution(solutionCloner = NQueensSolutionCloner.class)
public class NQueens {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, a <code>NQueens</code> planning clone only deep clones all <code>Queen</code> instances.
So when the original solution changes (later on during planning) and one or more <code>Queen</code> instances change,
the planning clone isn&#8217;t affected.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">public class NQueensSolutionCloner implements SolutionCloner&lt;NQueens&gt; {

    @Override
    public NQueens cloneSolution(CloneLedger ledger, NQueens original) {
        NQueens clone = new NQueens();
        ledger.registerClone(original, clone);
        clone.setId(original.getId());
        clone.setN(original.getN());
        clone.setColumnList(original.getColumnList());
        clone.setRowList(original.getRowList());
        List&lt;Queen&gt; queenList = original.getQueenList();
        List&lt;Queen&gt; clonedQueenList = new ArrayList&lt;Queen&gt;(queenList.size());
        for (Queen originalQueen : queenList) {
            Queen cloneQueen = new Queen();
            ledger.registerClone(originalQueen, cloneQueen);
            cloneQueen.setId(originalQueen.getId());
            cloneQueen.setColumn(originalQueen.getColumn());
            cloneQueen.setRow(originalQueen.getRow());
            clonedQueenList.add(cloneQueen);
        }
        clone.setQueenList(clonedQueenList);
        clone.setScore(original.getScore());
        return clone;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>The <code>cloneSolution()</code> method should only deep clone the planning entities.</em>
Notice that the problem facts, such as <code>Column</code> and <code>Row</code> are normally <em>not</em> cloned: even their <code>List</code> instances are <em>not</em> cloned.
If the problem facts were cloned too, then you would have to make sure that the new planning entity clones also refer to the new problem facts clones used by the cloned solution.
For example, if you were to clone all <code>Row</code> instances, then each <code>Queen</code> clone and the <code>NQueens</code> clone itself should refer to those new <code>Row</code> clones.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Cloning an entity with a <a href="#chainedPlanningVariable">chained</a> variable is devious: a variable of an entity A might point to another entity B.
If A is cloned, then its variable must point to the clone of B, not the original B.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="createAnUninitializedSolution">Create an uninitialized solution</h4>
<div class="paragraph">
<p>Create a <code>@PlanningSolution</code> instance to represent your planning problem&#8217;s dataset, so it can be set on the <code>Solver</code> as the planning problem to solve.
For example in n queens, an <code>NQueens</code> instance is created with the required <code>Column</code> and <code>Row</code> instances and every <code>Queen</code> set to a different <code>column</code> and every <code>row</code> set to <code>null</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">    private NQueens createNQueens(int n) {
        NQueens nQueens = new NQueens();
        nQueens.setId(0L);
        nQueens.setN(n);
        nQueens.setColumnList(createColumnList(nQueens));
        nQueens.setRowList(createRowList(nQueens));
        nQueens.setQueenList(createQueenList(nQueens));
        return nQueens;
    }

    private List&lt;Queen&gt; createQueenList(NQueens nQueens) {
        int n = nQueens.getN();
        List&lt;Queen&gt; queenList = new ArrayList&lt;Queen&gt;(n);
        long id = 0L;
        for (Column column : nQueens.getColumnList()) {
            Queen queen = new Queen();
            queen.setId(id);
            id++;
            queen.setColumn(column);
            // Notice that we leave the PlanningVariable properties on null
            queenList.add(queen);
        }
        return queenList;
    }</code></pre>
</div>
</div>
<div class="imageblock" style="text-align: left">
<div class="content">
<img src="optimizer/uninitializedNQueens04.png" alt="uninitializedNQueens04">
</div>
<div class="title">Figure 1. Uninitialized Solution for the Four Queens Puzzle</div>
</div>
<div class="paragraph">
<p>Usually, most of this data comes from your data layer, and your solution implementation just aggregates that data and creates the uninitialized planning entity instances to plan:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">        private void createLectureList(CourseSchedule schedule) {
            List&lt;Course&gt; courseList = schedule.getCourseList();
            List&lt;Lecture&gt; lectureList = new ArrayList&lt;Lecture&gt;(courseList.size());
            long id = 0L;
            for (Course course : courseList) {
                for (int i = 0; i &lt; course.getLectureSize(); i++) {
                    Lecture lecture = new Lecture();
                    lecture.setId(id);
                    id++;
                    lecture.setCourse(course);
                    lecture.setLectureIndexInCourse(i);
                    // Notice that we leave the PlanningVariable properties (period and room) on null
                    lectureList.add(lecture);
                }
            }
            schedule.setLectureList(lectureList);
        }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="useTheSolver">Using the Solver</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="theSolverInterface">The <code>Solver</code> interface</h3>
<div class="paragraph">
<p>A solver solves your planning problem. Solvers are built with a <code>SolverFactory</code>. You do not need to implement it manually. A solver can only solve one planning problem instance at a time.The following example shows a solver for the Solution problem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">public interface Solver&lt;Solution_&gt; {

    Solution_ solve(Solution_ problem);

    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A solver should only be accessed from a single thread, except for the methods that are specifically documented in javadoc as being thread-safe. The <code>solve()</code> method hogs the current thread. This can cause HTTP timeouts for REST services and it requires extra code to solve multiple datasets in parallel. To avoid such issues, use a <a href="#solverManager"><code>SolverManager</code></a> instead.</p>
</div>
</div>
<div class="sect2">
<h3 id="solvingAProblem">Solving a problem</h3>
<div class="paragraph">
<p>You can use the solver to solve a planning problem.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A <code>Solver</code> built from a solver configuration</p>
</li>
<li>
<p>An <code>@PlanningSolution</code> annotation that represents the planning problem instance</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Provide the planning problem as argument to the <code>solve()</code> method. The solver will return the best solution found.</p>
</div>
<div class="paragraph">
<p>+
The following examples solves the NQueens problem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">    NQueens problem = ...;
    NQueens bestSolution = solver.solve(problem);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>solve()</code> method will return an <code>NQueens</code> instance with every <code>Queen</code> assigned to a <code>Row</code>.</p>
</div>
<div class="imageblock" style="text-align: left">
<div class="content">
<img src="optimizer/solvedNQueens04.png" alt="solvedNQueens04">
</div>
<div class="title">Figure 2. Best Solution for the Four Queens Puzzle in 8ms (Also an Optimal Solution)</div>
</div>
<div class="paragraph">
<p>The <code>solve(Solution)</code> method can take a long time (depending on the problem size and the solver configuration). The <code>Solver</code> intelligently works through <a href="#searchSpaceSize">the search space</a> of possible solutions and remembers the best solution it encounters during solving.
Depending on a number of factors, including problem size, how much time the <code>Solver</code> has, the solver configuration, and so forth, <a href="#doesPlannerFindTheOptimalSolution">that best solution might or might not be an optimal solution</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The solution instance given to the method <code>solve(solution)</code> is changed by the <code>Solver</code>,
but do not mistake it for the best solution.</p>
</div>
<div class="paragraph">
<p>The solution instance returned by the methods <code>solve(solution)</code> or <code>getBestSolution()</code> is most likely <a href="#cloningASolution">a planning clone</a> of the instance given to the method <code>solve(solution)</code>, which implies it is a different instance.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The solution instance given to the <code>solve(Solution)</code> method does not need to be uninitialized.
It can be partially or fully initialized, which is often the case in <a href="#repeatedPlanning">repeated planning</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="environmentMode">Solver environment mode</h3>
<div class="paragraph">
<p>The environment mode allows you to detect common bugs in your implementation.
It does not affect the <a href="#logging">logging level</a>.</p>
</div>
<div class="paragraph">
<p>You can set the environment mode in the solver configuration XML file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;solver xmlns="https://www.optaplanner.org/xsd/solver" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="https://www.optaplanner.org/xsd/solver https://www.optaplanner.org/xsd/solver/solver.xsd"&gt;
  &lt;environmentMode&gt;FAST_ASSERT&lt;/environmentMode&gt;
  ...
&lt;/solver&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A solver has a single <code>Random</code> instance. Some solver configurations use the <code>Random</code> instance a lot more than others.
For example, simulated annealing depends highly on random numbers, while tabu search only depends on it to resolve score ties.
The environment mode influences the seed of that <code>Random</code> instance.</p>
</div>
<div id="environmentModeFullAssert" class="ulist">
<div class="title">Environment modes:</div>
<ul>
<li>
<p><strong>FULL_ASSERT</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>FULL_ASSERT mode turns on all assertions (such as assert that the incremental score calculation is uncorrupted for each move) to fail-fast on a bug in a Move implementation, a constraint, the engine itself, and so on.</p>
</div>
<div class="paragraph">
<p>This mode is reproducible (see the reproducible mode). It is also intrusive because it calls the method <code>calculateScore()</code> more frequently than a non-assert mode.</p>
</div>
<div class="paragraph">
<p>The FULL_ASSERT mode is very slow because it does not rely on incremental score calculation.</p>
</div>
<div id="environmentModeNonIntrusiveFullAssert" class="ulist">
<ul>
<li>
<p><strong>NON_INTRUSIVE_FULL_ASSERT</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>NON_INTRUSIVE_FULL_ASSERT mode turns on several assertions to fail-fast on a bug in a Move implementation, a constraint, the engine itself, and so on.</p>
</div>
<div class="paragraph">
<p>This mode is reproducible. It is non-intrusive because it does not call the method <code>calculateScore()</code> more frequently than a non assert mode.</p>
</div>
<div class="paragraph">
<p>The NON_INTRUSIVE_FULL_ASSERT mode is very slow because it does not rely on incremental score calculation.</p>
</div>
<div id="environmentModeFastAssert" class="ulist">
<ul>
<li>
<p><strong>FAST_ASSERT</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The FAST_ASSERT mode turns on most assertions (such as assert that an undoMove&#8217;s score is the same as before the Move) to fail-fast on a bug in a Move implementation, a constraint, the engine itself, and so on.</p>
</div>
<div class="paragraph">
<p>This mode is reproducible. It is also intrusive because it calls the method <code>calculateScore()</code> more frequently than a non assert mode.</p>
</div>
<div class="paragraph">
<p>The FAST_ASSERT mode is slow.</p>
</div>
<div class="paragraph">
<p>Write a test case that does a short run of your planning problem with the FAST_ASSERT mode on.</p>
</div>
<div id="environmentModeReproducible" class="ulist">
<ul>
<li>
<p><strong>REPRODUCIBLE</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The reproducible mode is the default mode because it is recommended during development. In this mode, two runs in the same OptaPlanner version execute the same code in the same order. Those two runs have the same result at every step, except if the following note applies. This enables you to reproduce bugs consistently.
It also allows you to benchmark certain refactorings, such as a score constraint performance optimization, fairly across runs.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Despite using REPRODCIBLE mode, your application might still not be fully reproducible for the following reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use of <code>HashSet</code> or another <code>Collection</code> which has an inconsistent order between JVM runs for collections of planning entities or planning values (but not normal problem facts), especially in the solution implementation. Replace it with <code>LinkedHashSet</code>.</p>
</li>
<li>
<p>Combining a time gradient dependent algorithms (most notably simulated annealing) together with time spent termination. A sufficiently large difference in allocated CPU time will influence the time gradient values. Replace simulated annealing with late acceptance. Or instead, replace time spent termination with step count termination.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Reproducible mode can be slightly slower than  non-reproducible mode.
If your production environment can benefit from reproducibility, use this mode in production.</p>
</div>
<div class="paragraph">
<p>In practice, reproducible mode uses the default, fixed <a href="#randomNumberGenerator">random seed</a> if no seed is specified, and it also disables certain concurrency optimizations such as work stealing.</p>
</div>
<div class="sect3">
<h4 id="environmentModeProduction"><code>NON_REPRODUCIBLE</code></h4>
<div class="paragraph">
<p>Non-reproducible mode can be slightly faster than reproducible mode.
Avoid using it during development because it makes debugging and bug fixing difficult.
If reproducibility isn&#8217;t important in your production environment, use non-reproducible mode in production.</p>
</div>
<div class="paragraph">
<p>In practice, this mode uses no fixed <a href="#randomNumberGenerator">random seed</a> if no seed is specified.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="logging">Changing the OptaPlanner Solver logging level</h3>
<div class="paragraph">
<p>You can change the logging level in an OptaPlanner solver to see what the Solver is doing. The following list describes the different logging levels:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>error</strong>: Logs errors, except those that are thrown to the calling code as a <code>RuntimeException</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If an error occurs, OptaPlanner normally fails fast: it throws a subclass of <code>RuntimeException</code> with a detailed message to the calling code.
It does not log it as an error itself to avoid duplicate log messages.
Except if the calling code explicitly catches and eats that <code>RuntimeException</code>, a <code>Thread</code>'s default <code>ExceptionHandler</code> will log it as an error anyway.
Meanwhile, the code is disrupted from doing further harm or obfuscating the error.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><strong>warn</strong>: Logs suspicious circumstances.</p>
</li>
<li>
<p><strong>info</strong>: Logs every phase and the solver itself. See <a href="#scopeOverview">scope overview</a>.</p>
</li>
<li>
<p><strong>debug</strong>: Logs every step of every phase. See <a href="#scopeOverview">scope overview</a>.</p>
</li>
<li>
<p><strong>trace</strong>: Logs every move of every step of every phase. See <a href="#scopeOverview">scope overview</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Turning on <code>trace</code> logging, will slow down performance considerably: it is often four times slower.
However, it is invaluable during development to discover a bottleneck.</p>
</div>
<div class="paragraph">
<p>Even <code>debug</code> logging can slow down performance considerably for fast stepping algorithms (such as Late Acceptance and Simulated Annealing),
but not for slow stepping algorithms (such as Tabu Search).</p>
</div>
<div class="paragraph">
<p>Both cause congestion in <a href="#multithreadedSolving">multithreaded solving</a> with most appenders, see below.</p>
</div>
<div class="paragraph">
<p>In Eclipse, <code>debug</code> logging to the console tends to cause congestion with a score calculation speeds above 10 000 per second.
Nor IntelliJ, nor the Maven command line suffer from this problem.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, set the logging level to <code>debug</code> logging to see when the phases end and how fast steps are taken:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>INFO  Solving started: time spent (3), best score (-4init/0), random (JDK with seed 0).
DEBUG     CH step (0), time spent (5), score (-3init/0), selected move count (1), picked move (Queen-2 {null -&gt; Row-0}).
DEBUG     CH step (1), time spent (7), score (-2init/0), selected move count (3), picked move (Queen-1 {null -&gt; Row-2}).
DEBUG     CH step (2), time spent (10), score (-1init/0), selected move count (4), picked move (Queen-3 {null -&gt; Row-3}).
DEBUG     CH step (3), time spent (12), score (-1), selected move count (4), picked move (Queen-0 {null -&gt; Row-1}).
INFO  Construction Heuristic phase (0) ended: time spent (12), best score (-1), score calculation speed (9000/sec), step total (4).
DEBUG     LS step (0), time spent (19), score (-1),     best score (-1), accepted/selected move count (12/12), picked move (Queen-1 {Row-2 -&gt; Row-3}).
DEBUG     LS step (1), time spent (24), score (0), new best score (0), accepted/selected move count (9/12), picked move (Queen-3 {Row-3 -&gt; Row-2}).
INFO  Local Search phase (1) ended: time spent (24), best score (0), score calculation speed (4000/sec), step total (2).
INFO  Solving ended: time spent (24), best score (0), score calculation speed (7000/sec), phase total (2), environment mode (REPRODUCIBLE).</code></pre>
</div>
</div>
<div class="paragraph">
<p>All time spent values are in milliseconds.</p>
</div>
<div class="paragraph">
<p>Everything is logged to <a href="http://www.slf4j.org/">SLF4J</a>, which is a simple logging facade
which delegates every log message to Logback, Apache Commons Logging, Log4j or java.util.logging.
Add a dependency to the logging adaptor for your logging framework of choice.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_logback_to_log_optaplanner_solver">Using Logback to log OptaPlanner Solver</h3>
<div class="paragraph">
<p>If you are not using any logging framework with OptaPlanner, use Logback.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>You have an OptaPlanner solver.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add the following Maven dependency to your project&#8217;s <code>pom.xml</code> file:</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You do not need to add an extra bridge dependency.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">    &lt;dependency&gt;
      &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
      &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
      &lt;version&gt;1.x&lt;/version&gt;
    &lt;/dependency&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the logging level on the <code>org.optaplanner</code> package in your <code>logback.xml</code> file as shown in the following example where <code><em>LEVEL</em></code> is a logging level listed in XREF:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;configuration&gt;

  &lt;logger name="org.optaplanner" level="_LEVEL_"/&gt;

  ...

&lt;/configuration&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If OptaPlanner doesn&#8217;t recognize the new level, temporarily add the system property <code>-Dlogback.<em>LEVEL</em>=true</code> to troubleshoot.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>When running multiple solvers or one <a href="#multithreadedSolving">multithreaded solver</a>,
most appenders, including the console, cause congestion with <code>debug</code> and <code>trace</code> logging.
Switch to an async appender to avoid this problem or turn off <code>debug</code> logging.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_using_log4j_to_log_an_optaplanner_solver">Using Log4J to log an OptaPlanner Solver</h3>
<div class="paragraph">
<p>You can configure OptaPlanner for Log4J, if you are already using Log4J and you do not want to switch to its faster successor, Logback.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have an OptaPlanner solver</p>
</li>
<li>
<p>You are using Log4J for Logging</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add the bridge dependency to the project <code>pom.xml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">    &lt;dependency&gt;
      &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
      &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;
      &lt;version&gt;1.x&lt;/version&gt;
    &lt;/dependency&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the logging level on the package <code>org.optaplanner</code> in your <code>log4j.xml</code> file as shown in the following example, where <code><em>LEVEL</em></code> is a logging level listed in XREF:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;log4j:configuration xmlns:log4j="http://jakarta.apache.org/log4j/"&gt;

  &lt;category name="org.optaplanner"&gt;
    &lt;priority value="_LEVEL_" /&gt;
  &lt;/category&gt;

  ...

&lt;/log4j:configuration&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Optional: If you have a multitenant application where multiple <code>Solver</code> instances might be running at the same time, separate the logging of each instance into separate files:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Surround the <code>solve()</code> call with  <a href="http://logback.qos.ch/manual/mdc.html">Mapped Diagnostic Context</a> (MDC):</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">        MDC.put("tenant.name",tenantName);
        MySolution bestSolution = solver.solve(problem);
        MDC.remove("tenant.name");</code></pre>
</div>
</div>
</li>
<li>
<p>Configure your logger to use different files for each <code>${tenant.name}</code>.
For example in Logback, use a <code>SiftingAppender</code> in <code>logback.xml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">  &lt;appender name="fileAppender" class="ch.qos.logback.classic.sift.SiftingAppender"&gt;
    &lt;discriminator&gt;
      &lt;key&gt;tenant.name&lt;/key&gt;
      &lt;defaultValue&gt;unknown&lt;/defaultValue&gt;
    &lt;/discriminator&gt;
    &lt;sift&gt;
      &lt;appender name="fileAppender.${tenant.name}" class="...FileAppender"&gt;
        &lt;file&gt;local/log/optaplanner-${tenant.name}.log&lt;/file&gt;
        ...
      &lt;/appender&gt;
    &lt;/sift&gt;
  &lt;/appender&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="content">
<div id="randomNumberGenerator" class="paragraph">
<p>=== Random number generator</p>
</div>
<div class="paragraph">
<p>Many heuristics and metaheuristics depend on a pseudorandom number generator for move selection, to resolve score ties, probability based move acceptance, and so on. During solving, the same <code>Random</code> instance is reused to improve reproducibility, performance, and uniform distribution of random values.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To change the random seed of that <code>Random</code> instance, specify a <code>randomSeed</code>:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;solver xmlns="https://www.optaplanner.org/xsd/solver" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="https://www.optaplanner.org/xsd/solver https://www.optaplanner.org/xsd/solver/solver.xsd"&gt;
  &lt;randomSeed&gt;0&lt;/randomSeed&gt;
  ...
&lt;/solver&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To change the pseudorandom number generator implementation, specify a <code>randomType</code>:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;solver xmlns="https://www.optaplanner.org/xsd/solver" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="https://www.optaplanner.org/xsd/solver https://www.optaplanner.org/xsd/solver/solver.xsd"&gt;
  &lt;randomType&gt;MERSENNE_TWISTER&lt;/randomType&gt;
  ...
&lt;/solver&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
The following types are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>JDK</code> (default): Standard implementation (<code>java.util.Random</code>).</p>
</li>
<li>
<p><code>MERSENNE_TWISTER</code>: Implementation by <a href="http://commons.apache.org/proper/commons-math/userguide/random.html">Commons Math</a>.</p>
</li>
<li>
<p><code>WELL512A</code>, <code>WELL1024A</code>, <code>WELL19937A</code>, <code>WELL19937C</code>, <code>WELL44497A</code> and <code>WELL44497B</code>: Implementation by <a href="http://commons.apache.org/proper/commons-math/userguide/random.html">Commons Math</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For most use cases, the randomType has no significant impact on the average quality of the best solution on multiple datasets.
If you want to confirm this on your use case, use the <a href="#benchmarker">benchmarker</a>.</p>
</div>
<div id="solverManager" class="paragraph">
<p>== SolverManager</p>
</div>
<div class="paragraph">
<p>A <code>SolverManager</code> is a facade for one or more <code>Solver</code> instances
to simplify solving planning problems in REST and other enterprise services.
Unlike the <code>Solver.solve(&#8230;&#8203;)</code> method, a <code>SolverManager</code> has the following characteristics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>SolverManager.solve(&#8230;&#8203;)</code> returns immediately</strong>: it schedules a problem for asynchronous solving without blocking the calling thread.
This avoids timeout issues of HTTP and other technologies.</p>
</li>
<li>
<p><code>SolverManager.solve(&#8230;&#8203;)</code> solves multiple planning problems of the same domain, in parallel.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Internally, a <code>SolverManager</code> manages a thread pool of solver threads, which call <code>Solver.solve(&#8230;&#8203;)</code>,
and a thread pool of consumer threads, which handle best solution changed events.</p>
</div>
<div class="paragraph">
<p>In <a href="#integrationWithQuarkus">Quarkus</a> and <a href="#integrationWithSpringBoot">Spring Boot</a>,
the <code>SolverManager</code> instance is automatically injected in your code.
Otherwise, build a <code>SolverManager</code> instance with the <code>create(&#8230;&#8203;)</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">SolverConfig solverConfig = SolverConfig.createFromXmlResource(".../cloudBalancingSolverConfig.xml");
SolverManager&lt;CloudBalance, UUID&gt; solverManager = SolverManager.create(solverConfig, new SolverManagerConfig());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each problem submitted to the <code>SolverManager.solve(&#8230;&#8203;)</code> methods must have a unique problem ID.
Later calls to <code>getSolverStatus(problemId)</code> or <code>terminateEarly(problemId)</code> use that problem ID
to distinguish between planning problems.
The problem ID must be an immutable class, such as <code>Long</code>, <code>String</code>, or <code>java.util.UUID</code>.</p>
</div>
<div class="paragraph">
<p>The <code>SolverManagerConfig</code> class has a <code>parallelSolverCount</code> property,
that controls how many solvers are run in parallel.
For example, if set to <code>4</code>, submitting five problems
has four problems solving immediately, and the fifth one starts when another one ends.
If those problems solve for 5 minutes each, the fifth problem takes 10 minutes to finish.
By default, <code>parallelSolverCount</code> is set to <code>AUTO</code>, which resolves to half the CPU cores,
regardless of the <a href="#multithreadedSolving"><code>moveThreadCount</code></a> of the solvers.</p>
</div>
<div class="paragraph">
<p>To retrieve the best solution, after solving terminates normally, use <code>SolverJob.getFinalBestSolution()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">CloudBalance problem1 = ...;
UUID problemId = UUID.randomUUID();
// Returns immediately
SolverJob&lt;CloudBalance, UUID&gt; solverJob = solverManager.solve(problemId, problem1);
...
CloudBalance solution1;
try {
    // Returns only after solving terminates
    solution1 = solverJob.getFinalBestSolution();
} catch (InterruptedException | ExecutionException e) {
    throw ...;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, there are better approaches, both for solving batch problems before an end-user needs the solution
as well as for live solving while an end-user is actively waiting for the solution, as explained below.</p>
</div>
<div class="paragraph">
<p>The current <code>SolverManager</code> implementation runs on a single computer node,
but future work aims to distribute solver loads across a cloud.</p>
</div>
<div id="solverManagerSolveBatch" class="paragraph">
<p>=== Solving batch problems</p>
</div>
<div class="paragraph">
<p>Batch solving is solving mulitple dataset in parrallel. Batch solving is particularly useful at night:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There are typically few or no problem changes in the middle of the night.
Some organizations even enforce a deadline, for example, <em>submit all day off requests before midnight</em>.</p>
</li>
<li>
<p>The solvers can run for much longer, often hours, because nobody is waiting for the results and CPU resources are often cheaper.</p>
</li>
<li>
<p>Solutions are available when employees arrive at work the next morning.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To solve multiple datasets in parallel (limited by <code>parallelSolverCount</code>),
call <code>solve(&#8230;&#8203;)</code> for each dataset:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">public class TimeTableService {

    private SolverManager&lt;TimeTable, Long&gt; solverManager;

    // Returns immediately, call it for every dataset
    public void solveBatch(Long timeTableId) {
        solverManager.solve(timeTableId,
                // Called once, when solving starts
                this::findById,
                // Called once, when solving ends
                this::save);
    }

    public TimeTable findById(Long timeTableId) {...}

    public void save(TimeTable timeTable) {...}

}</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div id="solverManagerSolveAndListen" class="paragraph">
<p>=== Solve and listen to show progress to the end-user</p>
</div>
<div class="paragraph">
<p>When a solver is running while an end-user is waiting for that solution,
the user might need to wait for several minutes or hours before receiving a result.
To assure the user that everything is going well,
show progress by displaying the best solution and best score attained so far.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To handle intermediate best solutions, use <code>solveAndListen(&#8230;&#8203;)</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">public class TimeTableService {

    private SolverManager&lt;TimeTable, Long&gt; solverManager;

    // Returns immediately
    public void solveLive(Long timeTableId) {
        solverManager.solveAndListen(timeTableId,
                // Called once, when solving starts
                this::findById,
                // Called multiple times, for every best solution change
                this::save);
    }

    public TimeTable findById(Long timeTableId) {...}

    public void save(TimeTable timeTable) {...}

    public void stopSolving(Long timeTableId) {
        solverManager.terminateEarly(timeTableId);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This implementation is using the database to communicate with the UI, which polls the database.
More advanced implementations push the best solutions directly to the UI or a messaging queue.</p>
</div>
</li>
<li>
<p>When the user is satisfied with the intermediate best solution
and does not want to wait any longer for a better one, call <code>SolverManager.terminateEarly(problemId)</code>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-07-26 12:12:14 EDT
</div>
</div>
</body>
</html>