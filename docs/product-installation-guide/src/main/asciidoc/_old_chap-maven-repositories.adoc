[id='_chap_maven_repositories']
= Maven Repositories

[id='_about_the_maven_repository1']
== About Maven

Apache Maven is a distributed build automation tool used in Java application development to build and manage software projects. Maven uses configuration XML files called POM (Project Object Model) to define project properties and manage the build process. POM files describe the project's module and component dependencies, build order, and targets for the resulting project packaging and output. This ensures that projects are built in a correct and uniform manner.

Maven uses repositories to store Java libraries, plug-ins, and other build artifacts. Repositories can be either local or remote. A local repository is a download of artifacts from a remote repository cached on a local machine. A remote repository is any other repository accessed using common protocols, such as `http://` when located on an HTTP server, or `file://` when located on a file server. The default repository is the public remote http://search.maven.org/#browse[Maven 2 Central Repository].

Configuration of Maven is performed by modifying the `settings.xml` file. You can either configure global Maven settings in the `_M2_HOME_/conf/settings.xml` file, or user-level settings in the `_USER_HOME_/.m2/settings.xml` file.

For more information about Maven, see the http://maven.apache.org/[Welcome to Apache Maven] page.

For more information about Maven repositories, see the http://maven.apache.org/guides/introduction/introduction-to-repositories.html[Apache Maven Project -- Introduction to Repositories] article.

For more information about Maven POM files, see http://maven.apache.org/pom.html[Apache Maven Project -- POM Reference].

NOTE: Your Red Hat JBoss product has been built with Maven 3.0._x_. Therefore, this is the recommended Maven version for building your own SwitchYard applications.

[id='_the_jboss_integration_maven_repository']
== About Provided Maven Repositories

A set of repositories containing artifacts required to build applications based on {PRODUCT} is provided with this release. Maven must be configured to use these repositories and the Maven Central Repository in order to provide correct build functionality.

Two interchangeable sets of repositories ensuring the same functionality are provided. The first set is available for download and storage in a local file system, the second set is hosted online for use as remote repositories.

IMPORTANT: The set of online remote repositories is a technology preview source of components. As such, it is not in scope of patching and is supported only for use in development environment. Using the set of online repositories in production environment is a potential source of security vulnerabilities and is therefore not a supported use case. For more information, see the https://access.redhat.com/site/maven-repository[JBoss Enterprise Maven Repository].

[id='_using_the_jboss_integration_maven_repository_local_access']
== Configuring Maven to Use File System Repositories

.Overview
In situations where you cannot use the online repositories, you will have to download and configure the required repositories locally.

. Download the following ZIP archives containing the required repositories:
ifdef::dv_gsg[]
* http://maven.repository.redhat.com/techpreview/brms6/6.0.3/jboss-bpms-brms-6.0.3.GA-redhat-1-maven-repository.zip
* http://maven.repository.redhat.com/techpreview/eap6/6.1.1/jboss-eap-6.1.1-maven-repository.zip
endif::dv_gsg[]
ifdef::PAM[]
* https://access.redhat.com/jbossnetwork/restricted/softwareDetail.html?softwareId=48461&product=bpm.suite&version=&downloadType=distributions
endif::PAM[]
ifdef::DM[]
* https://access.redhat.com/jbossnetwork/restricted/softwareDetail.html?softwareId=48311&product=brms&version=&downloadType=distributions
endif::DM[]
ifdef::fsw_gsg;fsw_install[]
* http://maven.repository.redhat.com/techpreview/fsw6/6.0.0/fsw-6.0.0.GA-redhat-2-repository.zip
* http://maven.repository.redhat.com/techpreview/eap6/6.1.1/jboss-eap-6.1.1-maven-repository.zip
endif::fsw_gsg;fsw_install[]

. Unzip the downloaded ZIP files into an arbitrary location in a local file system.

. Add entries for the unzipped repositories to Maven's `settings.xml` file. The following code sample contains a profile with the repositories, configuration of authentication for access to the repositories, and an activation entry for the profile:
+
[source,xml]
----
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<settings xmlns="http://maven.apache.org/SETTINGS/1.0.0"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:schemaLocation="http://maven.apache.org/xsd/settings-1.0.0.xsd">
  <localRepository/>
  <profiles>
  <!-- Profile with local repositories required by
       Red Hat JBoss BRMS/Red Hat JBoss BPM Suite -->
    <profile>
      <id>brms-bpms-local-profile</id>
      <repositories>
        <repository>
          <id>jboss-brms-bpmsuite-repository</id>
          <name>BRMS/BPMS 6.4.0 GA Repository</name>
          <url>
            file://<!-- path to the repository -->
                  /jboss-brms-bpmsuite-6.4.0.GA-maven-repository/maven-repository
          </url>
          <layout>default</layout>
          <releases>
            <enabled>true</enabled>
            <updatePolicy>never</updatePolicy>
          </releases>
          <snapshots>
            <enabled>false</enabled>
            <updatePolicy>never</updatePolicy>
          </snapshots>
        </repository>
      </repositories>
      <pluginRepositories>
        <pluginRepository>
          <id>jboss-brms-bpmsuite-repository</id>
          <name>BRMS/BPMS 6.4.0.GA Repository</name>
          <url>
            file://<!-- path to the repository -->
                  /jboss-brms-bpmsuite-6.4.0.GA-maven-repository/maven-repository
          </url>
          <layout>default</layout>
          <releases>
            <enabled>true</enabled>
            <updatePolicy>never</updatePolicy>
          </releases>
          <snapshots>
            <enabled>false</enabled>
            <updatePolicy>never</updatePolicy>
          </snapshots>
        </pluginRepository>
      </pluginRepositories>
    </profile>
  </profiles>

  <servers>
    <!-- Configuring pre-emptive authentication for the repository server -->
    <server>
      <id>brms-bpms-m2-repo</id>
      <username>admin</username>
      <password>admin</password>
      <configuration>
        <wagonProvider>httpclient</wagonProvider>
        <httpConfiguration>
          <all>
            <usePreemptive>true</usePreemptive>
          </all>
        </httpConfiguration>
      </configuration>
    </server>

    <!-- Alternative to enabling pre-emptive authentication - configuring
         the Authorization HTTP header with Base64-encoded credentials
    <server>
      <id>brms-bpms-m2-repo</id>
      <configuration>
        <httpHeaders>
          <property>
            <name>Authorization</name>
            <value>Basic YWRtaW46YWRtaW4=</value>
          </property>
        </httpHeaders>
      </configuration>
    </server>
    -->
  </servers>

  <activeProfiles>
    <!-- Activation of the Red Hat JBoss BRMS/Red Hat JBoss BPM Suite profile -->
    <activeProfile>brms-bpms-local-profile</activeProfile>
  </activeProfiles>
</settings>
----

.Result
The Maven repositories are downloaded, unzipped in a local file system, registered in Maven's `settings.xml` file, and ready to be used when performing Maven builds.

=== Troubleshooting

==== Why do I still get errors when building or deploying my applications?

.Issue
--
When you build or deploy a project, it fails with one or both of the following errors:

* `[ERROR] Failed to execute goal on project _PROJECT_NAME_`
* `Could not find artifact _ARTIFACT_NAME_`
--

.Cause
--
Your cached local Maven repository might contain outdated artifacts.
--

.Resolution
--
To resolve the issue, delete the cached local repository -- the `~/.m2/repository/` directory on Linux or the `%SystemDrive%\Users\USERNAME\.m2\repository\` directory on Windows -- and run `mvn clean install -U`. This will force Maven to download correct versions of required artifacts when performing the next build.
--

==== Why is Red Hat JBoss Developer Studio using my old Maven configuration?

.Issue
--
You have updated your Maven configuration, but this configuration is not reflected in Red Hat JBoss Developer Studio.
--

.Cause
--
If Red Hat JBoss Developer Studio is running when you modify your Maven `settings.xml` file, this configuration will not be reflected in Red Hat JBoss Developer Studio.
--

.Resolution
--
Refresh the Maven settings in the IDE. From the menu, choose *Window* -> *Preferences*. In the *Preferences* window, expand *Maven* and choose *User Settings*. Click the *Update Settings* button to refresh the Maven user settings in Red Hat JBoss Developer Studio.

image::128.png[Updating Maven Settings]
--

[id='_configure_the_jboss_eap_integration_maven_repository_using_the_maven_settings']
== Configuring Maven to Use Online Repositories

The online repositories required for {PRODUCT} applications are located at https://maven.repository.redhat.com/ga/.

It is possible to configure Maven to use online repositories using the project's POM file, but this is not recommended.

.Procedure: Configuring Maven to Use Online Repositories

. Add entries for the online repositories and configuration of authentication for accessing them to Maven's `settings.xml` file as in the code sample below:
+
[source,xml]
----
<settings xmlns="http://maven.apache.org/SETTINGS/1.0.0"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.0.0
                              http://maven.apache.org/xsd/settings-1.0.0.xsd">
  <profiles>
    <!-- Profile with online repositories required by BRMS/BPMS -->
    <profile>
      <id>brms-bpms-online-profile</id>
      <repositories>
        <repository>
          <id>jboss-ga-repository</id>
          <url>https://maven.repository.redhat.com/ga/</url>
          <releases>
            <enabled>true</enabled>
          </releases>
          <snapshots>
            <enabled>false</enabled>
          </snapshots>
        </repository>
      </repositories>
      <pluginRepositories>
        <pluginRepository>
          <id>jboss-ga-plugin-repository</id>
          <url>https://maven.repository.redhat.com/ga/</url>
          <releases>
            <enabled>true</enabled>
          </releases>
          <snapshots>
            <enabled>false</enabled>
          </snapshots>
        </pluginRepository>
      </pluginRepositories>
    </profile>
  </profiles>

  <servers>
    <!-- Configuring pre-emptive authentication for the repository server -->
    <server>
      <id>brms-bpms-m2-repo</id>
      <username>admin</username>
      <password>admin</password>
      <configuration>
        <wagonProvider>httpclient</wagonProvider>
        <httpConfiguration>
          <all>
            <usePreemptive>true</usePreemptive>
          </all>
        </httpConfiguration>
      </configuration>
    </server>

    <!-- Alternative to enabling pre-emptive authentication - configuring
         the Authorization HTTP header with Base64-encoded credentials
    <server>
      <id>brms-bpms-m2-repo</id>
      <configuration>
        <httpHeaders>
          <property>
            <name>Authorization</name>
            <value>Basic YWRtaW46YWRtaW4=</value>
          </property>
        </httpHeaders>
      </configuration>
    </server>
    -->
  </servers>

  <activeProfiles>
    <!-- Activation of the BRMS/BPMS profile -->
    <activeProfile>brms-bpms-online-profile</activeProfile>
  </activeProfiles>

</settings>
----

. If you modified the `settings.xml` file while Red Hat JBoss Developer Studio was running, you must refresh Maven settings in the IDE. From the menu, choose *Window* -> *Preferences*. In the *Preferences* window, expand *Maven* and choose *User Settings*. Click the *Update Settings* button to refresh the Maven user settings in Red Hat JBoss Developer Studio.
+
.Update Maven User Settings
image::128.png[]

.Result
Maven has been configured to use the online repositories provided for your Red Hat JBoss product.

[IMPORTANT]
====
If your cached local Maven repository contains outdated artifacts, you may encounter one of the following Maven errors when you build or deploy your project:

* `Missing artifact _ARTIFACT_NAME_`
* `[ERROR] Failed to execute goal on project _PROJECT_NAME_; Could not resolve dependencies for _PROJECT_NAME_`

To resolve the issue, delete the cached local repository -- the `~/.m2/repository/` directory on Linux or the `%SystemDrive%\Users\USERNAME\.m2\repository\` directory on Windows -- and run `mvn clean install -U`. This will force Maven to download correct versions of required artifacts when performing the next build.
====

[id='_dependency_management']
== Dependency Management

In order to use the correct Maven dependencies in your {PRODUCT} project, you must add relevant Bill Of Materials (BOM) files to the project's `pom.xml` file. Adding the BOM files ensures that the correct versions of transitive dependencies from the provided Maven repositories are included in the project.

To use the {PRODUCT} Maven artifacts, you need to configure one of the following:

* {PRODUCT} product online Maven repository -- for instructions, see <<_configure_the_jboss_eap_integration_maven_repository_using_the_maven_settings>>.
* {PRODUCT} product local-filesystem-based Maven repository -- for instructions, see <<_using_the_jboss_integration_maven_repository_local_access>>.

The Maven Central online repository, which is also required, is configured by default in Maven. It has to be reachable for your project to function properly, even if you selected the local Maven repository.

Depending on your project requirements, declare one of the following the dependencies in your POM file in the dependencies section.
ifdef::PAM[]
For further information about the versions, see <<_supported_comps>>.
endif::PAM[]
ifdef::DM[]
For further information about the versions, see the Supported Component Versions chapter of _Red Hat JBoss BPM Suite Installation Guide_.
endif::DM[]

* `org.jboss.bom.brms:jboss-brms-bpmsuite-platform-bom:$_VERSION_`
* `org.jboss.bom.brms:jboss-brms-bpmsuite-bom:$_VERSION_`

ifdef::fsw_gsg;fsw_install[]
To ensure correct dependency usage in your project, declare the following parent in the project's `pom.xml` file:
endif::fsw_gsg;fsw_install[]
ifdef::fsw_gsg;fsw_install[]
***
+
ifdef::fsw_gsg;fsw_install[]
`org.jboss.ip.component.management:ip-parent:1.1-redhat-5`
endif::fsw_gsg;fsw_install[]
ifdef::dv_gsg[]
`org.jboss.ip.component.management:ip-parent:1.1-redhat-4`
endif::dv_gsg[]
ifdef::BPMS;DM[]
`org.jboss.ip.component.management:ip-parent:1.2.1-redhat-2`
endif::BPMS;DM[]
endif::fsw_gsg;fsw_install[]
ifdef::fsw_gsg;fsw_install[]
and add the following two BOM files as dependencies in the `dependencyManagement` section:
endif::fsw_gsg;fsw_install[]
ifdef::fsw_gsg;fsw_install[]
***
+
ifdef::fsw_gsg;fsw_install[]
`org.jboss.ip.component.management:ip-dependency-management-all:1.1-redhat-5`
endif::fsw_gsg;fsw_install[]
ifdef::dv_gsg[]
`org.jboss.ip.component.management:ip-dependency-management-all:1.1-redhat-4`
endif::dv_gsg[]
*** `org.jboss.component.management:jboss-dependency-management-all:6.1.2.Final-redhat-5`
endif::fsw_gsg;fsw_install[]
ifdef::fsw_gsg;fsw_install[]
Use the entries from the code sample below for this purpose:
endif::fsw_gsg;fsw_install[]
ifdef::fsw_gsg;fsw_install[]
[source,xml]
----
<parent>
  <groupId>org.jboss.ip.component.management</groupId>
  <artifactId>ip-parent</artifactId>
  <version>1.1-redhat-5</version>
</parent>

...

<dependencyManagement>
  <dependencies>
    <dependency>
      <groupId>org.jboss.ip.component.management</groupId>
      <artifactId>ip-dependency-management-all</artifactId>
      <type>pom</type>
      <version>1.1-redhat-5</version>
      <scope>import</scope>
    </dependency>
    <dependency>
      <groupId>org.jboss.component.management</groupId>
      <artifactId>jboss-dependency-management-all</artifactId>
      <type>pom</type>
      <version>6.1.2.Final-redhat-5</version>
      <scope>import</scope>
    </dependency>
  </dependencies>
</dependencyManagement>
----
endif::fsw_gsg;fsw_install[]
ifdef::dv_gsg[]

[source,xml]
----
<parent>
  <groupId>org.jboss.ip.component.management</groupId>
  <artifactId>ip-parent</artifactId>
  <version>1.1-redhat-4</version>
</parent>

...

<dependencyManagement>
  <dependencies>
    <dependency>
      <groupId>org.jboss.ip.component.management</groupId>
      <artifactId>ip-dependency-management-all</artifactId>
      <type>pom</type>
      <version>1.1-redhat-4</version>
      <scope>import</scope>
    </dependency>
    <dependency>
      <groupId>org.jboss.component.management</groupId>
      <artifactId>jboss-dependency-management-all</artifactId>
      <type>pom</type>
      <version>6.1.2.Final-redhat-5</version>
      <scope>import</scope>
    </dependency>
  </dependencies>
</dependencyManagement>
----
endif::dv_gsg[]
