[id='patches-applying-proc']

= Applying patch updates to {PRODUCT}

Patch updates of {PRODUCT} typically include the latest security updates and bug fixes. A patch update tool is provided with new patch releases to update the product version to the newer patch release, such as from {PRODUCT} {PRODUCT_VERSION}.0 or {PRODUCT_VERSION}.1 to {PRODUCT} {PRODUCT_VERSION}.2. Standard patch updates contain all previously released patch updates for that version of the product, so you do not need to apply each patch update incrementally in order to apply the latest update. However, to keep your {PRODUCT} distribution current with the latest fixes, consider applying patch updates to {PRODUCT} as they become available in the Red Hat Customer Portal.

.Prerequisite
Your {PRODUCT} and {KIE_SERVER} instances are not running. Do not apply patch updates while you are running an instance of {PRODUCT} or {KIE_SERVER}.

.Procedure
. Navigate to the https://access.redhat.com/jbossnetwork/restricted/listSoftware.html[Software Downloads] page in the Red Hat Customer Portal (login required), and select the product and version from the drop-down options.
+
--
Example:

* *Product:* {PRODUCT_SHORT}
* *Version:* {PRODUCT_VERSION}.1
--
. Click *Patches*, download *{PRODUCT} [VERSION] Patch Update*, and extract the downloaded `{PRODUCT_INIT}-$VERSION-patch.zip` file to a temporary directory.
+
NOTE: If you use the standalone *{PRODUCT} {PRODUCT_VERSION_LONG} Maven Repository* artifact (`{PRODUCT_FILE}-maven-repository.zip`), such as in air-gap environments, then also download *{PRODUCT} [VERSION] Incremental Maven Repository* and extract the downloaded `{PRODUCT_INIT}-$VERSION-incremental-maven-repository.zip` file to your existing `~/maven-repository` directory to update the relevant contents.
+

. If you want to preserve any files from being updated by the patch, navigate to the extracted `{PRODUCT_INIT}-$VERSION-patch` folder, open the `blacklisted.txt` file, and add the relative paths to the files that you do not want to be updated.
+
--
When a file is listed in the `blacklist.txt` file, the patch update script does not replace the file with the new version but instead leaves the file in place and in the same location adds the new version with a `.new` suffix appended. If you blacklist files that are no longer being distributed, the patch update tool creates an empty marker file with the suffix `removed`. You can then choose to retain, merge, or delete these new files manually.

Example files to be excluded in `blacklisted.txt` file:
[source]
----
WEB-INF/web.xml  // Custom file
styles/base.css  // Obsolete custom file kept for record
----

The contents of the blacklisted file directories after the update:
[source]
----
$ ls WEB-INF
web.xml web.xml.new
----

[source]
----
$ ls styles
base.css base.css.removed
----
--
. In your command terminal, navigate to the temporary directory where you extracted the `{PRODUCT_INIT}-$VERSION-patch.zip` file and run the `apply-updates` script in the following format:
+
--
IMPORTANT: Make sure that your {PRODUCT} and {KIE_SERVER} instances are not running before you apply patch updates. Do not apply patch updates while you are running an instance of {PRODUCT} or {KIE_SERVER}.

On Linux or Unix-based systems:
[source]
----
$ ./apply-updates.sh $DISTRO_PATH $DISTRO_TYPE
----

On Windows:
[source]
----
$ ./apply-updates.bat $DISTRO_PATH $DISTRO_TYPE
----

The `$DISTRO_PATH` portion is the path to the relevant distribution directory and the `$DISTRO_TYPE` portion is the type of distribution that you are updating with this patch.

The following distribution types are supported in {PRODUCT} patches:

* {URL_COMPONENT_CENTRAL}-eap7-deployable
* kie-server-ee7
ifdef::DM[]
* kie-server-jws
endif::DM[]
* controller-ee7
ifdef::DM[]
* controller-jws
endif::PAM[]

For example, the following command applies the extracted patch update to {CENTRAL} for a {PRODUCT} distribution on {EAP}:

[source]
----
./apply-updates.sh ~EAP_HOME/standalone/deployments/decision-central.war decision-central-eap7-deployable
----

NOTE: Only updates for {PRODUCT} are included in the {PRODUCT} patch distribution. Patches to {EAP} must be applied using {EAP} patch distributions. For more information about {EAP} patching, see the {EAP} https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.1/html/patching_and_upgrading_guide/[Patching and upgrading guide].

The patch update script creates a `backup` folder in the extracted `{PRODUCT_INIT}-$VERSION-patch` folder with a copy of the specified distribution, and proceeds with the update.
--
. After the update completes, start {PRODUCT} and {KIE_SERVER} and log in to {CENTRAL}.
. In the top-right corner of {CENTRAL}, click your profile name and click *About* to verify the updated product version number.
+
If you encounter any errors, you can restore the previous version of the updated distribution found in the `backup` folder within the `{PRODUCT_INIT}-$VERSION-patch` folder, and then try again to run the patch update.
