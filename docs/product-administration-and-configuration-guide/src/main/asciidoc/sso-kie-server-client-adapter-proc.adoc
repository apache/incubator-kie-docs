[id='sso-kie-server-client-adapter-proc']
= Installing and configuring {KIE_SERVER} with the client adapter

After you install RH-SSO, you must install the RH-SSO client adapter for {EAP} and configure it for {KIE_SERVER}.

.Prerequisites

* RH-SSO is installed as described in <<sso-realm-proc>>.
* At lease one user with the `kie-server` role has been added to RH-SSO as described in <<sso-user-add-proc>>.
* {KIE_SERVER} is installed in a {EAP} 7.1 instance, as described in _INSTALLING AND CONFIGURING RED HAT PROCESS AUTOMATION MANAGER ON EAP 7.1_.


[NOTE]
====
If you deployed {KIE_SERVER} to a different application server than {PRODUCT}, install and configure RH-SSO on your second server as well.
====

.Procedure
.Procedure
. Download the {EAP} adapter:
.. Log in to the https://access.redhat.com[Red Hat Customer Portal].
.. Click *DOWNLOADS* at the top of the page.
.. On the *Product Downloads* page that opens, navigate to the JBOSS INTEGRATION AND AUTOMATION section, and click *Red Hat Single Sign-On*.
.. On the *Software Downloads* page, if necessary select *7.2* from the *Version* menu.
.. Download *Red Hat Single Sign-on 7.2.0 Client Adaptor for JBoss EAP 7* (`rh-sso-7.2.0.GA-eap7-adapter.zip`).
. Unzip and install `rh-sso-7.2.0.GA-eap7-adapter.zip`. For installation instructions, see the https://access.redhat.com/documentation/en/red-hat-single-sign-on/7.0/securing-applications-and-services-guide/securing-applications-and-services-guide#jboss_adapter[JBoss EAP Adapter] section of the _Red Hat Single Sign On Securing Applications and Services Guide_.
. Go to `_EAP_HOME_/standalone/configuration` and open the `standalone.xml` and `standalone-full.xml` files. 
. Delete the `<single-sign-on/>` element from both of the files.
. Navigate to `_EAP_HOME_/standalone/configuration` directory in your {EAP} installation and edit the `standalone.xml` file to add the RH-SSO subsystem configuration. For example:
+
. Navigate to `_EAP_HOME_/standalone/configuration` in your {EAP} installation and edit the `standalone.xml` file to add the RH-SSO subsystem configuration. For example:
+
--
[source,xml]
----
<subsystem xmlns="urn:jboss:domain:keycloak:1.1">
  <secure-deployment name="kie-execution-server.war">
     <realm>demo</realm>
     <realm-public-key>MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCrVrCuTtArbgaZzL1hvh0xtL5mc7o0NqPVnYXkLvgcwiC3BjLGw1tGEGoJaXDuSaRllobm53JBhjx33UNv+5z/UMG4kytBWxheNVKnL6GgqlNabMaFfPLPCF8kAgKnsi79NMo+n6KnSY8YeUmec/p2vjO2NjsSAVcWEQMVhJ31LwIDAQAB</realm-public-key>
     <auth-server-url>http://localhost:8180/auth</auth-server-url>
     <ssl-required>external</ssl-required>
     <resource>kie-execution-server</resource>
     <enable-basic-auth>true</enable-basic-auth>
     <credential name="secret">03c2b267-7f64-4647-8566-572be673f5fa</credential>
     <principal-attribute>preferred_username</principal-attribute>
  </secure-deployment>
</subsystem>

<system-properties>
  <property name="org.kie.server.sync.deploy" value="false"/>
</system-properties>
----

In this example:

* `secure-deployment name` is the name of your application WAR file.
* `realm` is the name of the realm that you created for the applications to use.
* `realm-public-key` is the  public key of the realm you created. You can find the key in the *Keys* tab in the *Realm settings* page of the realm you created in the RH-SSO Admin Console. If you do not provide a value for this public key, the server retrieves it automatically.
* `auth-server-url` is the  URL for the RH-SSO authentication server.
* `resource` is the name for the server client that you created.
* `enable-basic-auth` is the setting to enable basic authentication mechanism, so that the clients can use both token-based and basic authentication approaches to perform the requests.
* `credential name` is the secret key of the server client you created. You can find the key in the *Credentials* tab on the *Clients* page of the RH-SSO Admin Console.
* `principal-attribute` is the login name of the user. If you do not provide this value, your User Id is displayed in the application instead of your user name.
--
+

. Save your configuration changes in the `standalone.xml` file.
. Use the following command to restart the {EAP} server and run {KIE_SERVER}.
+
[source]
----
EXEC_SERVER_HOME/bin/standalone.sh -Dorg.kie.server.id=<ID> -Dorg.kie.server.user=<USER> -Dorg.kie.server.pwd=<PWD> -Dorg.kie.server.location=<LOCATION_URL> -Dorg.kie.server.controller=<CONTROLLER_URL> -Dorg.kie.server.controller.user=<CONTROLLER_USER> -Dorg.kie.server.controller.pwd=<CONTOLLER_PASSWORD>
----
+
For example:
+
[source]
----
EXEC_SERVER_HOME/bin/standalone.sh -Dorg.kie.server.id=kieserver1 -Dorg.kie.server.user=kieserver -Dorg.kie.server.pwd=password -Dorg.kie.server.location=http://localhost:8080/kie-execution-server/services/rest/server -Dorg.kie.server.controller=http://localhost:8080/decision-central/rest/controller -Dorg.kie.server.controller.user=kiecontroller -Dorg.kie.server.controller.pwd=password
----
+
. When {KIE_SERVER} is running, enter the following command to check the server status, where `<KIE_SERVER_USER>` is a user with the `kie-server` role and `<PASSWORD>` is the password for that user:
+
[source]
----
curl http://<KIE_SERVER_USER>:<PASSWORD>@localhost:8080/kie-execution-server/services/rest/server/
----
