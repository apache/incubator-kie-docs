[id='guided-rules-WHEN-proc']
= Adding WHEN conditions in guided rules

The *WHEN* part of the rule is the condition that must be met to execute an action. For example, if a bank requires loan applicants to have over 21 years of age, then the *WHEN* condition would be `Age | greater than | 21`. You can set simple or complex conditions to determine how and when your rules are applied.

.Prerequisite
All data objects required for your rules are listed in the *Data Objects* tab of the guided rule designer. See xref:guided-rules-create-proc[] for details.

.Procedure
. In the guided rule designer, click the plus icon (image:5686.png[]) on the right side of the `WHEN` section.
+
The *Add a condition to the rule...* window with the available condition elements opens.
+
.Add a condition to the rule
image::5687.png[Add a condition to the rule]
+
The list includes the data objects from the *Data Objects* tab of the guided rule designer, any DSL objects defined for the package (if you selected *Use Domain Specific Language (DSL)* when you created this guided rule), and the following standard options:

* *The following does not exist:* Use this to specify facts and constraints that must not exist.
* *The following exists:* Use this to specify facts and constraints that must exist. This option is triggered on only the first match, not subsequent matches.
* *Any of the following are true:* Use this to list facts and constraints that must be true.
* *From:* Use this to define a `From` conditional element for the rule.
* *From Accumulate:* Use this to define an `Accumulate` conditional element for the rule.
* *From Collect:* Use this to define a `Collect` conditional element for the rule.
* *From Entry Point:* Use this to define an `Entry Point` for the pattern.
* *Free form DRL:* Use this to insert a free-form DRL field where you can define condition elements freely, without the guided rule designer.
+
*<@Michael: I was going to put a note here about template keys, but they don't apply to free form DRL within the guided rule designer, right? Or do they? And I don't see any option in the guided editor either for template keys, when I modify values, so maybe template keys just don't apply to GRE in general? I thought they only applied when you can define the values to be interpolated with the keys, such as with guided decision tables and with DRL files (which come with a table in the DRL designer for exactly that purpose). I'm still digesting the whole template keys thing.>*
+
////
.Template keys in free form DRL
[NOTE]
====
With free form DRL, you have the flexibility to add custom data types, such as template keys. Template keys are placeholder variables in your field constraints that are interpolated with a specified value when the DRL rules are generated. You can add a template key value to facts in the format `@key`. For example, `Person( age > @{age} )` creates an `$age` column in the decision table.
====
////
. Choose a condition element (for example, *LoanApplication*) and click *Ok*.
. Click the condition element in the guided rule designer and use the *Modify constraints for LoanApplication* window to add a restriction on a field, apply multiple field constraints, add a new formula style expression, apply an expression editor, or set a variable name.
. Modify the condition to suit your needs. For example, set a variable name that can help define the condition, or add a restriction.
+
.Modify a condition
image::5689.png[Modifying a condition]
+
Once you select a restriction, the window closes automatically.
. Choose an operator for the restriction (for example, `greater than`) from the drop-down menu next to the added restriction.

. Click the edit icon (image:6191.png[]) to define the field value. The field value can be a literal value, a formula, or a full MVEL expression.

. To apply multiple field constraints, click the condition and in the *Modify constraints for LoanApplication* window, select *All of(And)* or *Any of(Or)* from the *Multiple field constraint* drop-down menu.
+
.Add multiple field constraints
image::5688.png[Modifying a condition]

. Click the constraint in the guided rule designer.
. In the *Add fields to this constraint*  window, specify the fields and their values. For example, by clicking *New Formula*, you can add a new formula expression that is later evaluated to be true or false.
+
.Multiple field constraint on formula expression
image::loanapp.png[Multiple field constraint on formula expression]

. After you define all condition elements, click *Save* in the guided rule designer to save your work.
