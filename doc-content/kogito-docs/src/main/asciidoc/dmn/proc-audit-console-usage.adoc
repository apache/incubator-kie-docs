[id='proc-audit-console-using_{context}']
= Using the {PRODUCT} Audit Investigation Console to view DMN model execution details

You can use the {PRODUCT} Audit Investigation Console to view DMN model execution details for your {PRODUCT} services. You can run the Audit Investigation Console for local {PRODUCT} services or add it to your {PRODUCT} infrastructure on {OPENSHIFT}.

.Prerequisites
* A {PRODUCT} Trusty Service instance and Explainbility Service instance are configured and running for your {PRODUCT} service. The Trusty Service enables the Audit Investigation Console to access stored DMN model execution data. The Trusty Service requires Infinispan persistence and Apache Kafka messaging for your {PRODUCT} service. For information about the Trusty Service, see
ifdef::KOGITO[]
{URL_CONFIGURING_KOGITO}#con-trusty-service_kogito-configuring[_{CONFIGURING_KOGITO}_].
endif::[]
ifdef::KOGITO-COMM[]
xref:con-trusty-service_kogito-configuring[].
endif::[]
* The `pom.xml` file of your {PRODUCT} project contains the following dependency for the tracing add-on. This add-on enables the Trusty Service to interact with the decision-tracing data through the CloudEvents messages.
+
.Project dependency to enable tracing capability on Quarkus
[source,xml]
----
<dependency>
  <groupId>org.kie.kogito</groupId>
  <artifactId>tracing-decision-quarkus-addon</artifactId>
</dependency>
----
+
.Project dependency to enable tracing capability on SpringBoot
[source,xml]
----
<dependency>
  <groupId>org.kie.kogito</groupId>
  <artifactId>tracing-decision-springboot-addon</artifactId>
</dependency>
----

* The `application.properties` file of your {PRODUCT} project contains the following system property for the location where the {PRODUCT} service is deployed, such as `\http://localhost:8080`. This property enables the Explainability Service to generate the URLs to interact with {PRODUCT} and enrich tracing data with explainbility.
+
.Application property for REST URLs
[source,subs="+quotes"]
----
kogito.service.url=http://__HOST__:__PORT__
----
+
NOTE: In a Kubernetes or OpenShift environment, if you specified the `KOGITO_SERVICE_URL` environment variable in the relevant container, this application property in your {PRODUCT} project is not required for the Explainability Service.

.Procedure
. Go to the https://repository.jboss.org/org/kie/kogito/trusty-ui/[`trusty-ui`] artifacts page, select the latest release of the {PRODUCT} Audit Investigation Console, and download the `trusty-ui-__VERSION__-runner.jar` file to a local directory.
. In a command terminal, navigate to the directory location of the downloaded `trusty-ui-__VERSION__-runner.jar` file and enter the following command to run the Audit Investigation Console:
+
--
.Running the Audit Investigation Console
[source,subs="+quotes"]
----
$ java -Dquarkus.http.port=9000 -jar trusty-ui-__VERSION__-runner.jar
----

[NOTE]
====
The default port for the Audit Investigation Console is 8080, but this example specifies port 9000 to avoid conflicts with the example {PRODUCT} service running at port 8080.
====

In an OpenShift environment, you can use the {PRODUCT} command-line interface (CLI) or the OpenShift web console to add the Audit Investigation Console to your {PRODUCT} infrastructure.

In the `trusty-ui` CLI command, replace the Trusty Service host and port values with the host and port of your running Trusty Service instance. This command includes a `KOGITO_TRUSTY_ENDPOINT` environment variable that injects the specified Trusty Service endpoint into the Audit Investigation Console service container.

.Adding the Audit Investigation Console to your OpenShift infrastructure using the {PRODUCT} CLI
[source,subs="+quotes"]
----
$ kogito trusty-ui --env KOGITO_TRUSTY_ENDPOINT=http://trusty:8080
----

.{PRODUCT} Audit Investigation Console instance on OpenShift web console
image::kogito/dmn/kogito-audit-console-instance.png[Image of Kogito Audit Investigation Console instance on OpenShift]

If you did not already install the required Trusty Service and Explainability Service, you can likewise use the OpenShift web console to add these instances and try again to add the Audit Investigation Console instance.

.{PRODUCT} Trusty Service instance on OpenShift web console
image::kogito/dmn/kogito-trusty-instance.png[Image of Kogito Trusty Service instance on OpenShift]

.{PRODUCT} Explainability Service instance on OpenShift web console
image::kogito/dmn/kogito-explainability-instance.png[Image of Kogito Explainability Service instance on OpenShift]
--

. In a web browser, navigate to `http://localhost:9000` to open the Audit Investigation Console. If you modified the configured Trusty UI port, use the modified location.
+
--
On OpenShift, navigate to the route URL for the Audit Investigation Console instance.

.{PRODUCT} Audit Investigation Console
image::kogito/dmn/kogito-audit-console-home.png[Image of Kogito Audit Investigation Console]

The Audit Investigation Console displays data for all available DMN model executions. By default, executions are filtered to display results from the last month. To modify the list view, you can use the search or sort fields at the top of the screen.
--
. In the DMN model executions list, select an execution ID to view and navigate through the details for the selected execution.
+
--
.Execution details page
image::kogito/dmn/kogito-audit-console-execution-detail.png[Image of execution details page]

At the top of the execution details page, you can hover your cursor over the execution status to view information about execution date, time, and executor.

.Execution status tooltip
image::kogito/dmn/kogito-audit-console-execution-status-tooltip.png[Image of Execution Status Tooltip, 303]
--
. In the execution details page, use the following tabs in the top menu to view different aspects of the DMN model execution:
+
--
* *Outcomes*: Use this page to view a list of the decision outcomes in the current execution. Each outcome is a card containing the output of the decision. You can click *View Details* for each card to open the *Outcome Details* section for that specific outcome.
* *Outcome Details*: Use this page to view information about decision outcomes of the execution.
+
.Outcome Details page
image::kogito/dmn/kogito-audit-console-outcomes-details.png[Image of Outcome Details page]
+
You can change which outcome to view by selecting from the drop-down options in the top menu.
+
.Outcomes selection
image::kogito/dmn/kogito-audit-console-outcomes-switch.png[Image of Outcomes selection]
+
The *Explanation* section provides insight about how the inputs of the model influenced the decision outcome. A score from `-1` to `1` is assigned to each input, representing its positive or negative effect on the decision result. Score values are rounded to the second decimal digit. If you hover your cursor over the graph bars, you can also see the full score value. Next to the *Features Score Chart* panel, the *Features Weight* panel contains the same scores in a tabular view, grouped by positive and negative weight.
+
The *Outcome Influencing Inputs* section provides a list of the inputs that were considered during the elaboration of the current decision outcome. The inputs typically consist of a sub-set of the inputs provided to the DMN model, or may consist of all provided inputs. For complex input structures, you can select from the *Browse Sections* options to view different input sections.
* *Input Data*: Use this page to view all inputs submitted to the DMN model for the current execution, including all inputs that were not incorporated in the outcomes processing. For complex input structures, you can select from the *Browse Sections* options to view different input sections.
+
.Input Data page
image::kogito/dmn/kogito-audit-console-input-data.png[Image of Input Data page]
* *Model Lookup*: Use this page to view the decision requirements diagram (DRD) of the executed DMN model.
+
.Model Lookup page
image::kogito/dmn/kogito-audit-console-model-lookup.png[Image of Model Lookup page]
+
[NOTE]
====
The *Model Lookup* viewer currently does not support DMN models that include other DMN models or PMML models.
====
--

For example {PRODUCT} services that use the Trusty Service and Explainability Service, see the following example applications in GitHub:

* https://github.com/kiegroup/kogito-examples/tree/stable/dmn-tracing-quarkus[`dmn-tracing-quarkus`]: A DMN decision service on Quarkus that uses the `tracing-decision-quarkus-addon` add-on to generate tracing events that the {PRODUCT} Trusty Service and Explainability Service can consume and expose.
* https://github.com/kiegroup/kogito-examples/tree/stable/trusty-demonstration[`trusty-demonstration`]: A tutorial for deploying the `dmn-tracing-quarkus` example application on Kubernetes as a demonstration of {PRODUCT} Trusty Service and Explainability Service capabilities in a cloud environment.
