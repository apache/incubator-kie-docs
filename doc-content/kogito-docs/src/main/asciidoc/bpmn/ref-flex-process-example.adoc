[id='ref-flex-process-example_{context}']
= Flexible process example

A typical flexible process consists of one or more of the following basic components:

* Optional start event (might or might not be explicit)
* Optional node connections (might or might not connect all nodes)
* Enabled `Ad-Hoc` process property
* One or more subprocesses, typically ad hoc subprocesses
* Ad hoc auto-start fragments, such as ad hoc subprocesses or ad hoc tasks
* Milestones that flag or trigger events
* End event to terminate the process

The following example is a real-world BPMN model scenario that demonstrates how you can use flexible processes for case management. In this scenario, a service desk uses a flexible process for handling customer tickets related to problems or questions about a specific product.

NOTE: This example is based on the `flexible-process-quarkus` application in the https://github.com/kiegroup/kogito-examples[`kogito-examples`] repository in GitHub. However, this example may differ from the exact example source code as {PRODUCT} continues to be developed. Be sure to explore this and other {PRODUCT} examples in GitHub to help you develop your own applications.

.Example `service-desk.bpmn2` flexible process
image::kogito/bpmn/bpmn-flex-process-example.png[Image of `service-desk.bpmn2` example process]

To start the process and generate a ticket, a user provides an initial `supportCase` object in a REST request that contains information about the product, the customer, and the related issue:

.Example REST request to start the process and generate a ticket
[source,json]
----
{
  "supportCase": {
    "customer": "Paco the customer",
    "description": "Kogito is not working for some reason.",
    "product": {
      "family": "Middleware",
      "name": "Kogito"
    }
  }
}
----

After the ticket is generated, the `Triage` ad hoc subprocess is automatically started and the ticket is assigned to a support team and then to a support engineer. If the system cannot determine which team to assign the ticket to, a user assigns the ticket manually to a support engineer.

The decision logic for the `Triage` subprocess is defined in the following `SupportGroup` decision table in the `triage.dmn` Decision Model and Notation (DMN) model:

.Example `SupportGroup` DMN decision table
image::kogito/bpmn/bpmn-flex-process-example-decision-table.png[Image of `SupportGroup` example DMN decision table]

The `Work case` ad hoc subprocess is also automatically started when the process is created. Anyone from the `customer` and `support` groups can add comments. To create a task that can be used to add a comment, a user can send an empty `POST` request as shown in the following example:

.Example curl request
[source]
----
curl -D -XPOST -H 'Content-Type:application/json' -H 'Accept:application/json' http://localhost:8080/serviceDesk/b3c75b24-2691-4a76-902c-c9bc29ea076c/ReceiveSupportComment
----

.Example response (JSON)
[source,json]
----
HTTP/1.1 201 Created
Content-Length: 305
Location: http://localhost:8080/serviceDesk/b3c75b24-2691-4a76-902c-c9bc29ea076c/ReceiveSupportComment/f3b36cf9-3953-43ae-afe6-2a48fea8a79a
Content-Type: application/json

{
  "id":"b3c75b24-2691-4a76-902c-c9bc29ea076c",
  "supportCase":{
    "product": {
      "name":"Kogito",
      "family":"Middleware"
    },
    "description":"Kogito is not working for some reason.",
    "engineer":"kelly",
    "customer":"Paco the customer",
    "state":"WAITING_FOR_OWNER",
    "comments":null,
    "questionnaire":null
  },
  "supportGroup":"Kogito"
}
----

A user can then use the URL in the `Location` HTTP header when rendering the `form action`, as shown in the following example:

.Example form action for a user comment
[source]
----
<form action="http://localhost:8080/serviceDesk/b3c75b24-2691-4a76-902c-c9bc29ea076c/ReceiveSupportComment/f3b36cf9-3953-43ae-afe6-2a48fea8a79a" method="post">
  <label for="comment">Comment:</label>
  <input type="text" id="comment" name="comment">
</form>
----

After the customer is satisfied with the ticket response and actions, a user clicks a *Resolve Case* button, which sends an empty `POST` request to the service task to set the case to `Resolved` and the process emits a `CaseResolved` event. This event signals the `CaseResolved` milestone, which starts the `Close` ad hoc subprocess that sends, receives, and saves the customer questionnaire and closes the case.
