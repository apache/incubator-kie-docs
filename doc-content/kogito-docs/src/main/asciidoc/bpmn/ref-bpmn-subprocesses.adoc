[id='ref-bpmn-subprocesses_{context}']
= Subprocesses supported in {PRODUCT}

BPMN subprocesses are portions of a parent process that contain process nodes. You can embed part of the parent process within a subprocess. You can also include variable definitions within the subprocess. These variables are accessible to all nodes inside the subprocess.

A subprocess must have one incoming connection and one outgoing connection. A terminate end event inside a subprocess ends the subprocess instance but does not automatically end the parent process instance. A subprocess ends when there are no more active elements in it.

//@comment: Excluded for now until multiple-instance subprocesses are officially supported in Kogito. (Stetson, 19 June 2020)
//A multiple-instance subprocess is instantiated multiple times when its execution is triggered. The instances are created sequentially. A new subprocess instance is created only after the previous instance has finished. A multiple-instance subprocess has one incoming connection and one outgoing connection.

In the following example, the `Place order` subprocess checks whether sufficient stock is available to place the order and updates the stock information if the order can be placed. The customer is then notified through the main process based on whether the order was placed.

.Example subprocess
image::kogito/bpmn/subprocess.png[]

{PRODUCT} currently supports the following subprocesses:

.Supported subprocesses
[cols="40%,60%", options="header"]
|===
| Subprocess type
| Subprocess node

| Embedded subprocess
| image:kogito/bpmn/bpmn-embedded-subprocess.png[]

| Ad hoc subprocess
| image:kogito/bpmn/bpmn-adhoc-subprocess.png[]

| Reusable subprocess
| image:kogito/bpmn/bpmn-reusable-subprocess.png[]
|===

Embedded subprocess::
+
--
An embedded subprocess encapsulates a part of the parent process and shares the parent process data. This subprocess must contain a start event and at least one end event. You can define local subprocess variables that are accessible to all elements inside this container.

NOTE: Multiple-instance behavior is currently not supported for embedded subprocesses in {PRODUCT}.

In the {PRODUCT} BPMN modeler, you can modify the following properties for a selected embedded subprocess:

.Embedded subprocess properties
[cols="30%,70%", options="header"]
|===
|Label
|Description

| *Name*
| Identifies the name of the subprocess.

| *Documentation*
| Describes the subprocess. The text in this field is included in the process documentation, if applicable.

| *On Entry Action*
| Not supported in {PRODUCT}. This property defines a Java, JavaScript, or MVEL script that directs an action at the start of the subprocess, and is currently available only in distributions of the BPMN modeler in jBPM and Red Hat Process Automation Manager.

| *On Exit Action*
| Not supported in {PRODUCT}. This property defines a Java, JavaScript, or MVEL script that directs an action at the end of the subprocess, and is currently available only in distributions of the BPMN modeler in jBPM and Red Hat Process Automation Manager.

| *Is Async*
|  Determines whether this subprocess is invoked asynchronously. Make subprocesses asynchronous if they cannot be executed instantaneously, such as a subprocess performed by an outside service.

| *SLA Due Date*
| Specifies the date when the service level agreement (SLA) expires.

| *Process Variables*
| Defines any process variables for the subprocess. Process variables are visible within the specific subprocess instance. Process variables are initialized at subprocess creation and destroyed on subprocess completion. Variable *Tags* provide greater control over the variable behavior, such as whether the variable is `required` or `internal`. For more information about variable tags, see xref:con-bpmn-variables_kogito-developing-process-services[].
|===
--

Ad hoc subprocess::
+
--
An ad hoc subprocess contains embedded inner activities and is intended to be executed with a more flexible ordering compared to the typical routing of processes. Unlike typical processes, an ad hoc subprocess does not contain a complete, structured BPMN diagram description, such as from a start event to an end event. Instead, the ad hoc subprocess contains only activities, sequence flows, gateways, and intermediate events. An ad hoc subprocess can also contain data objects and data associations.

The activities within ad hoc subprocesses are not required to have incoming and outgoing sequence flows. However, you can specify sequence flows between some of the contained activities. Sequence flows provide the same ordering constraints in ad hoc subprocesses as in a typical process. Any intermediate events must have outgoing sequence flows and they can be triggered multiple times while the ad hoc subprocess is active.

In the {PRODUCT} BPMN modeler, you can modify the following properties for a selected ad hoc subprocess:

.Ad hoc subprocess properties
[cols="30%,70%", options="header"]
|===
|Label
|Description

| *Name*
| Identifies the name of the subprocess.

| *Documentation*
| Describes the subprocess. The text in this field is included in the process documentation, if applicable.

| *AdHocActivationCondition*
a| Defines a Java expression that determines when the subprocess is activated, such as `order.isShipped()` in a process that uses an `order` process variable. To activate the subprocess automatically when the parent process starts, leave this field empty with no condition specified.

NOTE: This field supports only Java expressions and does not support Drools expressions as indicated in the field label. This label will be updated in a future release.

| *AdHocCompletionCondition*
a| Defines a Java expression that determines when the subprocess is completed, such as `order.isDelivered()` in a process that uses an `order` process variable. By default, this field contains the value `autocomplete` to complete the subprocess automatically when the subprocess ends.

NOTE: This field supports only Java expressions and does not support Drools and MVEL expressions as indicated in the field label. This label will be updated in a future release.

| *AdHocOrdering*
| Not supported in {PRODUCT}. This property specifies whether the subprocess is executed in *Sequential* or *Parallel* order in the parent process, and is currently available only in distributions of the BPMN modeler in jBPM and Red Hat Process Automation Manager.

| *On Entry Action*
| Not supported in {PRODUCT}. This property defines a Java, JavaScript, or MVEL script that directs an action at the start of the subprocess, and is currently available only in distributions of the BPMN modeler in jBPM and Red Hat Process Automation Manager.

| *On Exit Action*
| Not supported in {PRODUCT}. This property defines a Java, JavaScript, or MVEL script that directs an action at the end of the subprocess, and is currently available only in distributions of the BPMN modeler in jBPM and Red Hat Process Automation Manager.

| *Is Async*
|  Determines whether this subprocess is invoked asynchronously. Make subprocesses asynchronous if they cannot be executed instantaneously, such as a subprocess performed by an outside service.

| *SLA Due Date*
| Specifies the date when the service level agreement (SLA) expires.

| *Process Variables*
| Defines any process variables for the subprocess. Process variables are visible within the specific subprocess instance. Process variables are initialized at subprocess creation and destroyed on subprocess completion. Variable *Tags* provide greater control over the variable behavior, such as whether the variable is `required` or `internal`. For more information about variable tags, see xref:con-bpmn-variables_kogito-developing-process-services[].
|===
--

Reusable subprocess::
+
--
A reusable subprocess calls another process or subprocess instance to be used within a parent process. This subprocess enables you to reuse the same process repeatedly without manually duplicating the subprocess.  This subprocess typically appears collapsed within the parent process.

In the {PRODUCT} BPMN modeler, you can modify the following properties for a selected reusable subprocess:

.Reusable subprocess properties
[cols="30%,70%", options="header"]
|===
|Label
|Description

| *Name*
| Identifies the name of the subprocess.

| *Documentation*
| Describes the subprocess. The text in this field is included in the process documentation, if applicable.

| *Called Element*
| Specifies the ID of the process or subprocess that the activity calls and instantiates.

| *Independent*
| Determines whether the subprocess is started and completed independently of the parent process or whether the subprocess is canceled when the parent process is terminated.

| *Abort Parent*
| (Available only when *Independent* is not selected.) Determines whether a dependent reusable subprocess can abort the parent process when the subprocess is aborted or when an error occurs during the subprocess execution.

| *Wait for completion*
| Determines whether the parent process must wait for this subprocess to complete before continuing.

| *Is Async*
|  Determines whether this subprocess is invoked asynchronously. Make subprocesses asynchronous if they cannot be executed instantaneously, such as a subprocess performed by an outside service.

| *Multiple Instance*
a| Determines whether the subprocess is executed multiple times. When you select this option, the following additional options appear:

* *MI Execution mode*: Specifies whether the multiple subprocess instances are executed in *Sequential* or *Parallel* order as each instance is triggered. In sequential order, a triggered subprocess starts only after the previous subprocess instance completes. In parallel order, a subprocess instance starts whenever it is triggered and can run in parallel with any other triggered subprocesses.
* *MI Collection input*: Specifies the process variable that represents a collection of elements for which new instances are created. The subprocess is instantiated as many times as needed according to the size of the collection.
* *MI Data Input*: Specifies the name of the process variable that contains the selected element in the collection. The variable is used to access elements in the collection.
* *MI Collection output*: (Optional) Specifies the process variable that represents the collection of elements that gather the output of the multi-instance node.
* *MI Data Output*: Specifies the name of the process variable that is added to the output collection that you selected in the *MI Collection output* property.
* *MI Completion Condition*: Not supported in {PRODUCT}. This property defines a Java expression that is evaluated on each completed subprocess instance, and is currently available only in distributions of the BPMN modeler in jBPM and Red Hat Process Automation Manager.

////
//@comment: MI Completion Condition description for when it is supported. (Stetson, 1 July 2020)
Defines a Java expression that is evaluated on each completed subprocess instance to verify if the specified multi-instance node can complete, such as `order.isShipped()` in a process that uses an `order` process variable. When the completion condition is met, in sequential execution mode, no other subprocess instances are created, and in parallel execution mode, any running subprocess instances are cancelled.

NOTE: The *MI Completion Condition* field supports only Java expressions and does not support MVEL expressions as indicated in the field label. This label will be updated in a future release.
////

| *On Entry Action*
| Not supported in {PRODUCT}. This property defines a Java, JavaScript, or MVEL script that directs an action at the start of the subprocess, and is currently available only in distributions of the BPMN modeler in jBPM and Red Hat Process Automation Manager.

| *On Exit Action*
| Not supported in {PRODUCT}. This property defines a Java, JavaScript, or MVEL script that directs an action at the end of the subprocess, and is currently available only in distributions of the BPMN modeler in jBPM and Red Hat Process Automation Manager.

| *SLA Due Date*
| Specifies the date when the service level agreement (SLA) expires.

| *Assignments*
| Defines data input and output for the task. Click to open the *Data I/O* window and add data input and output as required.
|===
--

////
.Event subprocess


An event subprocess becomes active when its start event is triggered. It can interrupt the parent process context or run in parallel with it.

With no outgoing or incoming connections, only an event or a timer can trigger the subprocess. The subprocess is not part of the regular control flow.
Although self-contained, it is executed in the context of the bounding process.

Use an event subprocess within a process flow to handle events that happen outside of the main process flow.
For example, while booking a flight, two events may occur:

* Cancel booking (interrupting)
* Check booking status (non-interrupting)

You can model both of these events using the event subprocess.
////
