[id='proc-management-console-security_{context}']
= Enabling {PRODUCT} Management Console security with OpenID Connect

For Quarkus-based {PRODUCT} services, you can use the https://quarkus.io/guides/security-openid-connect[Quarkus OpenID Connect adapter] with the {PRODUCT} Management Console to enable the console to interact with the {PRODUCT} Data Index Service using bearer token authorization. These tokens are issued by OpenID Connect and OAuth 2.0 compliant authorization servers such as https://www.keycloak.org/about.html[Keycloak].

IMPORTANT: This procedure applies only when you are using a locally cloned copy of the https://github.com/kiegroup/kogito-apps/tree/master/management-console[{PRODUCT} Management Console] repository in GitHub.

.Prerequisites
* You have cloned the https://github.com/kiegroup/kogito-apps/tree/master/management-console[{PRODUCT} Management Console] repository from GitHub.

.Procedure
In a command terminal, navigate to the local clone of the {PRODUCT} Management Console repository and enter the following command to run the application with security enabled:

.Run the Management Console with security enabled
[source]
----
mvn clean compile quarkus:dev -Dquarkus.profile=keycloak
----

IMPORTANT: Ensure that the service is not started at the same port as the security server. You can change the port by adding `-Dquarkus.http.port=__PORT_NUMBER__` to the start-up properties.

The {PRODUCT} Management Console contains a Quarkus profile to encapsulate the security configuration, so if the service requires security enabled, you can specify the `quarkus.profile=keycloak` property at build time to enable the needed security. If the `keycloak` Quarkus profile is not added, the OpenID Connect extension is disabled.

- Navigate to the `src/main/resources/application.properties` file of the Management Console project and add the following properties:
+
.Required security properties in `applications.properties` file
[source]
----
# OpenID Connect configurations
%keycloak.quarkus.oidc.enabled=true
%keycloak.quarkus.oidc.tenant-enabled=true
%keycloak.quarkus.oidc.auth-server-url=http://localhost:8280/auth/realms/kogito
%keycloak.quarkus.oidc.client-id=kogito-console-quarkus
%keycloak.quarkus.oidc.credentials.secret=secret
%keycloak.quarkus.oidc.application-type=web-app
%keycloak.quarkus.oidc.logout.path=/logout
%keycloak.quarkus.oidc.logout.post-logout-path=/

# HTTP security configurations
%keycloak.quarkus.http.auth.permission.authenticated.paths=/*
%keycloak.quarkus.http.auth.permission.authenticated.policy=authenticated
----

NOTE: The `quarkus.oidc.enabled` property enables or disables security at build time, while the `quarkus.oidc.tenant-enabled` property enables or disables security at runtime.

- Replace any property definitions with those of your specific environment, especially the following properties:
+
* `quarkus.oidc.auth-server-url`: The base URL of the OpenID Connect (OIDC) server, such as `https://localhost:8280/auth`. All other OIDC server page and service URLs are derived from this URL. If you work with Keycloak OIDC server, ensure that the base URL is in the following format: `https://__HOST__:__PORT__/auth/realms/__KEYCLOAK_REALM__`.
* `quarkus.oidc.client-id`: The client ID of the application. Each application has a client ID that is used to identify the application.
* `quarkus.oidc.credentials.secret`: The client secret for the application.

NOTE: If you are enabling security at runtime using the `quarkus.oidc.tenant-enabled` property, the `quarkus.http.auth.permission' path and policy must specify how authentication applied.

- In the same `application.properties` file, also configure the resources to be exposed and the required permissions for accessing the resources.

For more information about the `application.properties` file, see https://quarkus.io/guides/security-openid-connect#configuring-using-the-application-properties-file[Configuring the application.properties file] in Quarkus documentation.

For more information about multi-tenancy with OpenID Connect, see https://quarkus.io/guides/security-openid-connect-multitenancy[Using OpenID Connect multi-tenancy] in Quarkus documentation.

The `quarkus.http.auth` properties define paths and policies to be applied, as described in the https://quarkus.io/guides/security[Quarkus Security Guide]. By default, if security is enabled, the user must be authenticated to access any path.
