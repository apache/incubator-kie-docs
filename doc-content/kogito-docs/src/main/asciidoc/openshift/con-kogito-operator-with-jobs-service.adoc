[id='con-kogito-operator-with-jobs-service_{context}']
= {PRODUCT} Operator interaction with the {PRODUCT} Jobs Service

{PRODUCT} provides a Jobs Service for scheduling Business Process Model and Notation (BPMN) process events that are configured to be executed at a specified time. These time-based events in a process model are known as _jobs_.

By default, {PRODUCT} services use an in-memory timer service to handle jobs defined in your BPMN process models. This default timer service does not cover long time intervals and is only suitable for short delays defined in the process. For advanced use cases where time intervals can be days or weeks or when additional event handling options are required, you can configure your {PRODUCT} project to use the {PRODUCT} Jobs Service as an external timer service.

You can use the following {PRODUCT} command-line interface (CLI) operation to install the {PRODUCT} Jobs Service for job scheduling in {PRODUCT} services:

.Enable Jobs Service
[source,subs="attributes+,+quotes"]
----
$ {PRODUCT_INIT} install jobs-service -p __PROJECT_NAME__
----

When you enable the Jobs Service for your {PRODUCT} project, the {PRODUCT} Operator creates a `KogitoJobsService` custom resource to handle the Jobs Service deployment for you. This resource is added to your {PRODUCT} project and in the {PRODUCT} Operator page of the *Installed Operators* listed in the OpenShift web console, if applicable.

.Additional resources
ifdef::KOGITO[]
* {URL_CONFIGURING_KOGITO}#con-jobs-service_kogito-configuring[{PRODUCT} Jobs Service]
endif::[]
ifdef::KOGITO-COMM[]
* xref:con-jobs-service_kogito-configuring[]
endif::[]

== Infinispan persistence with the {PRODUCT} Jobs Service

To enable Infinispan persistence for the {PRODUCT} Jobs Service, you can use the `--enable-persistence` flag during deployment in the {PRODUCT} CLI or edit the `spec.infinispan.useKogitoInfra` configuration in the `KogitoJobsService` custom resource:

* `true`: Infinispan is installed in the same namespace as the Jobs Service.
* `false`: Infinispan is not installed. Job data is persisted with the Jobs Service in-memory storage during the Jobs Service runtime. If the Jobs Service is restarted, all job information is lost.

.Example Jobs Service deployment with Infinispan persistence enabled
[source,subs="attributes+,+quotes"]
----
$ {PRODUCT_INIT} install jobs-service --enable-persistence
----

.Example `KogitoJobsService` resource with Infinispan persistence enabled
[source,yaml]
----
apiVersion: app.kiegroup.org/v1alpha1
kind: KogitoJobsService
metadata:
  name: jobs-service
spec:
  enablePersistence: true
  build:
    envs:
    - name: MAVEN_ARGS_APPEND
      value: -Ppersistence
----

You can refine the Infinispan integration by setting the properties `spec.infinispan.credentials`,
`spec.infinispan.uri`, and `spec.infinispan.useKogitoInfra` to `false` in the `KogitoJobsService` custom resource. With these properties set, the Infinispan Server is not deployed and the Jobs Service does not connect to the given URI. However, ensure that your cluster has access to this URI.

== {PRODUCT} Jobs Service properties configuration

When the {PRODUCT} Jobs Service is deployed, a `configMap` resource is created for the `application.properties` configuration of the Jobs Service.

The name of the `configMap` resource consists of the name of the Jobs Service and the suffix `-properties`, as shown in the following example:

.Example `configMap` resource generated during {PRODUCT} Jobs Service deployment
[source,yaml]
----
kind: ConfigMap
apiVersion: v1
metadata:
  name: jobs-service-properties
data:
  application.properties : |-
    property1=value1
    property2=value2
----

The `application.properties` data of the `configMap` resource is mounted in a volume to the container of the Jobs Service. Any runtime properties that you add to the `application.properties` section override the default application configuration properties of the Jobs Service.

When the `application.properties` data of the `configMap` is changed, a rolling update modifies the deployment and configuration of the Jobs Service.
