[id='proc-kogito-travel-agency-deploy-binary_{context}']
= Deploying {PRODUCT} services on OpenShift using a binary build

OpenShift builds can require extensive amounts of time. As a faster alternative for building and deploying your {PRODUCT} services on OpenShift, you can use a binary build. In a binary build, you build the application locally and push the built application to an OpenShift `BuildConfig` configuration to be packaged into the runtime container image.

The https://github.com/kiegroup/kogito-examples/tree/stable/kogito-travel-agency/extended[`kogito-travel-agency`] extended example application includes a `BuildConfig` configuration to support a binary build in addition to traditional building for deployment.

[NOTE]
====
{PRODUCT} also supports Source-to-Image (S2I) builds, which build the application in an OpenShift build and then pass the built application to the next OpenShift build to be packaged into the runtime container image. The {PRODUCT} S2I build configuration also enables you to build the project directly from a Git repository on the OpenShift platform.

However, this example uses the local applications to demonstrate how to prepare the {PRODUCT} project on a development machine for a direct push to the cloud.
====

.Prerequisites
* You have created the {PRODUCT} service definitions and provisioned the OpenShift resources required for deployment with a binary build, as described in xref:proc-kogito-travel-agency-create-services_kogito-deploying-on-openshift[].

.Procedure
. In a command terminal, navigate to the `kogito-travel-agency/extended/travels` example service and build the project using Maven:
+
--
.Building the local travels project
[source]
----
$ cd kogito-travel-agency/extended/travels
$ mvn clean package
----

This command builds the project in standard JDK mode to package the application as a runner JAR file and include any dependencies in a `lib` folder.

ifdef::KOGITO-COMM[]
NOTE: Alternatively, you can also build the project in native mode (requires GraalVM and SubstrateVM) to build and compile the application into a native executable for your system.
endif::[]

--
The following resources are generated in the `target` folder in preparation for deployment from binary build:

* `travels-1.0-SNAPSHOT.jar`: Standard JAR file with only the classes and resources of the project.
* `travels-1.0-SNAPSHOT-runner.jar`: Executable JAR file for the project. Note that this is not an uber-JAR file because the dependencies are copied into the `target/lib` directory.
* `lib`: Directory with project dependencies.
. From the same `kogito-travel-agency/extended/travels` directory location where you built the project, enter the following command to deploy the travels service to OpenShift using a binary build:
+
--
.Deploying to OpenShift using binary build
[source]
----
$ oc start-build travels-binary --from-dir=target/

Uploading directory "target/" as binary input for the build ...
....
Uploading finished
build.build.openshift.io/travels-1 started
----

You can use the following command to check the logs of the builder pod if needed:

.Checking logs of builder pod
[source]
----
$ oc logs -f build/travels-binary-1
----

After the binary build is complete, the result is pushed to the `travels` Image Stream that was created by the {PRODUCT} Operator and triggers a new deployment.
--
. In the OpenShift web console, use the left menu to navigate to the following windows to verify the deployed service:
+
--
* *Workloads* -> *Deployments*: Select the `travels` deployment to view the application deployment details, pod status, and other details.
+
.Travels deployment details
image::kogito/openshift/kogito-ocp-app-deployment-details-agency.png[Image of travels service deployment details page in web console]
* *Networking* -> *Routes*: Select the *Location* URL for the `travels` route to view the main page of the {PRODUCT} travel agency application.
+
.Travel agency application interface
image::kogito/openshift/kogito-ocp-travel-agency-app.png[Image of Travel Agency application main page]

After you verify that the travel agency application is deployed, repeat the same steps to deploy the visas application.
--
. In a command terminal, navigate to the `kogito-travel-agency/extended/visas` example service and build the project using Maven:
+
--
.Building the local visas project
[source]
----
$ cd kogito-travel-agency/extended/visas
$ mvn clean package
----
--
. Deploy the visas service to OpenShift using a binary build:
+
--
.Deploying to OpenShift using binary build
[source]
----
$ oc start-build visas-binary --from-dir=target/

Uploading directory "target/" as binary input for the build ...
....
Uploading finished
build.build.openshift.io/visas-1 started
----

You can use the following command to check the logs of the builder pod if needed:

.Checking logs of builder pod
[source]
----
$ oc logs -f build/visas-binary-1
----

After the binary build is complete, the result is pushed to the `visas` Image Stream that was created by the {PRODUCT} Operator and triggers a new deployment.
--
. In the OpenShift web console, use the left menu to navigate to the following windows to verify the deployed service:
+
--
* *Workloads* -> *Deployment Configs*: Select the `visas` deployment to view the application deployment configurations, pod status, and other details.
+
.Visas deployment details
image::kogito/openshift/kogito-ocp-app-deployment-details-visas.png[Image of visas service deployment details page in web console]
* *Networking* -> *Routes*: Select the *Location* URL for the `visas` route to view the main page of the {PRODUCT} visas application.
+
.Visas application interface
image::kogito/openshift/kogito-ocp-visas-app.png[Image of Visas application main page]

--
