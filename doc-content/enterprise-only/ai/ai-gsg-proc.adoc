[id='ai-gsg_{context}']

= P

Use case: Card transaction dispute
End user can dispute a card transaction and the system has to decide if the dispute can be automatically processed (aka accept the dispute and refund the user) or if it requires to have manual verification

.Prerequisites:

* {PRODUCT} is available and the following JAR files have been added to the `~/kie-server.war/WEB-INF/lib` and `~/business-central.war/WEB-INF/lib` directories in your {PRODUCT} installation:
+
** `kie-dmn-jpmml-{BOM_VERSION}.jar`
+
** `kie-dmn-jpmml-{BOM_VERSION}.jar`
+
These files are available in the {PRODUCT_DM} {PRODUCT_VERSION}  Maven Repository distribution avaialable from the [https://access.redhat.com/jbossnetwork/restricted/listSoftware.html[Software Downloads] page in the Red Hat Customer Portal (login required).

** https://mvnrepository.com/artifact/org.jpmml/pmml-evaluator/1.5.1[JPMML Evaluator 1.5.1 JAR file]
** https://mvnrepository.com/artifact/org.jpmml/pmml-evaluator-extension/1.5.1[JPMML Evaluator Extensions 1.4.9 JAR file]
+
These files are required to enable JPMML evaluation in {KIE_SERVER} and {CENTRAL}.


.Procedure
. Download the `dtree_risk_predictor.pmml` file from COMMENT: need location.
. In {CENTRAL}, create the *Credit Card Dispute* project:
.. Navigate to *Menu -> Design -> Projects*.
.. Click *Add Project*.
.. In the *Name* box, enter `Credit Card Dispute` and click *Add*.
. In the Assets window of the *Credit Card Dispute* project, import the `dtree_risk_predictor.pmml` file into the `com` package.
+
image:ai/import-pmml.png[]
+
.. Click *Import Asset*.
.. In the *Create new Import Asset* dialog, enter `dtree_risk_predictor` in the *Name* box, select *com* from the *Package* menu, select the `dtree_risk_predictor.pmml` file, and click *OK*.
+
The content of the `dtree_risk_predictor.pmml` file appears in the Overview window.
. Create the *Dispute Transaction Check* DMN model in com package.
+
image:ai/dmn-asset.png[]
+
.. To return to the project window, click *Credit Card Dispute* in the breadcrumb trail.
.. Click *Add Asset*.
.. Click *DMN* in the asset library.

.. In the *Create new DMN* dialog, enter enter `Dispute Transaction Check` in the *Name* box, select *com* from the *Package* menu, and click *OK*.
+
The DMN editor opens with the *Dispute Transaction Check* DMN model.
. Create the *tTransaction* custom data type.
+

.. Click the *Data Types* tab.
.. Click *Add a custom Data Type*.
.. In the *Name* box, enter `tTransaction`.
.. Select *Structure* from the *Type* menu.
.. To create the data type, click the check mark.
+
The *tTransaction* custom data type appears with
.. In the *Name* field, enter `transaction_amount`, select *Number* from the *Type* menu, and then click the check mark.
.. To add a new row, click the plus symbol on the `transaction_amount` line. A new row appears.
.. In the *Name* field, enter `cardholder_identifier`, select *Number* from the *Type* menu, and then click the check mark.
Create "tTransaction" Data Type, with type Structure with transaction_amount (number) and cardholder_identifier (number) fields
Include Model, select PMML model and name it "Risk Predictor"
5:03
Create Node BKM with name "Risk Preditor" of type P (PMML), select "Risk Predictor" file and "DecisionTreeClassifier" as model
Create Input node with name "Transaction" and type "tTransaction"
7:47

Propertiess > Information Item > Data type > tTransaction.

Create Decision node "Transaction Dispute Risk" with "Transaction" node as input and "Risk Predictor" as function. Drag arro from Risk Predictor to Transaction Dispute Risk.
(Drag Decision icon and arrow attaches)

Click Transaction Dispute Risk. Type of the decision "Invocation". Enter function name "Risk Predictor" in Enter function box.

Line one, "amount", number parameter with Literal expression "Transaction.transaction_amount"
Right click on 1 and select insert below.
 "holder_index" parameter with Literal expression "Transaction.cardholder_identifier"
10:01

Create Input node with name "Risk threshold" and type "number" (properties)
Drag decision node from Risk threshold.
Create Decision node "Can be automatically processed?" that takes as inputs "Transaction Dispute Risk" and "Risk threshold". (Drag arro from Transaction Dispute Risk)
For Can automatically be processed, select Edit. Click Select Expression and select Literal expression.
Select Literal expression and use "Transaction Dispute Risk.predicted_dispute_risk < Risk threshold"
Save
NOTE: predicted_dispute_risk is the name of the target field specified in the PMML file

At the Asset library level, build.

Test the model:
Create Test Scenario asset in package "com"
Provide name "Test Dispute Transaction Check"
Select DMN and "Dispute Transaction Check"
Specify values ...
Execute
